<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Enfusion Script API: Replication overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Enfusion Script API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Replication overview </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#RplDocs_Introduction">Introduction</a></li>
<li class="level1"><a href="#RplDocs_BigPicture">The Big Picture</a><ul><li class="level2"><a href="#RplDocs_BigPicture_Implications">Architecture implications</a></li>
</ul>
</li>
<li class="level1"><a href="#RplDocs_Fundamentals">Fundamentals</a><ul><li class="level2"><a href="#RplDocs_Fundamentals_Ex1">Example animation without replication</a></li>
<li class="level2"><a href="#RplDocs_Fundamentals_Ex2">Example animation with replication</a></li>
<li class="level2"><a href="#RplDocs_Fundamentals_Ex3">Example system with per-player controller</a></li>
</ul>
</li>
<li class="level1"><a href="#RplDocs_Glossary">Glossary</a></li>
<li class="level1"><a href="#Concepts">Concepts</a></li>
<li class="level1"><a href="#DataFlow">Data flow</a></li>
<li class="level1"><a href="#StateReplication">State replication</a><ul><li class="level2"><a href="#StateReplication_Examples">Examples</a></li>
</ul>
</li>
<li class="level1"><a href="#RemoteProcedureCalls">Remote procedure calls (RPCs)</a><ul><li class="level2"><a href="#RemoteProcedureCalls_RoutingTable">RPC routing table (RRT)</a></li>
</ul>
</li>
<li class="level1"><a href="#Codecs">Codecs</a></li>
<li class="level1"><a href="#NetworkedLogic">Networked logic</a><ul><li class="level2"><a href="#NetworkedLogic_Case1">Setting 1: Listen server and a client</a></li>
<li class="level2"><a href="#NetworkedLogic_Case2">Setting 2: Dedicated server and two clients</a></li>
<li class="level2"><a href="#NetworkedLogic_Case3">Setting 3: Single-player</a></li>
<li class="level2"><a href="#NetworkedLogic_Takeaway">Takeaway - TLDR</a></li>
</ul>
</li>
<li class="level1"><a href="#ItemRegistration">Item registration</a><ul><li class="level2"><a href="#ItemRegistration_RplNode">Lightweight using enf::RplNode</a></li>
<li class="level2"><a href="#ItemRegistration_RplComponent">Entity system using gamelib::BaseRplComponent</a></li>
</ul>
</li>
<li class="level1"><a href="#Streaming">Streaming</a></li>
<li class="level1"><a href="#LifeCycle">Life cycle</a></li>
<li class="level1"><a href="#Caveats">Caveats</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="RplDocs_Introduction"></a>
Introduction</h1>
<p>Gameplay networking in the Enfusion engine is based client-server architecture model. In this model, server is authoritative over game simulation and acts as the source of truth. Each client only communicates with the server, never with other clients, and server decides what each client knows about and what it can do at any given moment.</p>
<p>Replication is a system for facilitating and simplifying implementation of game world and simulation shared by multiple players over network. It introduces high level concepts and mechanisms for handling issues inherent in multiplayer games, such as:</p><ul>
<li>unreliability of network communication, where packets may be lost or arrive out of order</li>
<li>limited amount of bandwidth available for network communication</li>
<li>malicious players using cheats to gain unfair advantage over others</li>
</ul>
<p>It is important to keep in mind that while replication provides tools, it is up to users (programmers and scripters) to make sure they are used appropriately. Understanding and accounting for the impact of replication on architecture of game objects (entities and components) as well as gameplay systems early in the project development is crucial. Some design decisions may be hard or impossible to change later in the development (often due to time constraints and many other things being built on top of them) and so it is important that they are efficiently networked and tested from the very beginning.</p>
<h1><a class="anchor" id="RplDocs_BigPicture"></a>
The Big Picture</h1>
<p>Let us first introduce the terminology and how all things work together, before going into specifics. This section will only give rough description of how things work in the most common situations and leave important details and specifics for later.</p>
<p>Replication runs in one of two modes: <b>server</b> or <b>client</b>. Server hosts replication session and clients connect to this session. There is always exactly one server and there can be any number of players (up to max player limit). Server is the only one who knows about everything and if it disappears, session ends and clients are disconnected. It is not possible for a client to take over when server has disappeared.</p>
<p>Server can be hosted in one of two modes: <b>listen server</b> and <b>dedicated server</b>. Listen server is server hosted by one of the players. It accepts inputs (keyboard, mouse, controller, etc.) from hosting player directly and provides audio-visual output to hosting player. Dedicated server does not have a way to accept inputs or provide audio-visual output and it only allows players to connect remotely.</p>
<p>The smallest unit that replication works with, is an <b>item</b>. Only items created on server will be shared with clients. Item created on a client will only exist on this client and nobody else can see it. An item can by many things, but the most common ones are entities and components. Not all entities and components are items, though. For an entity or component to be registered in replication as an item, it must have at least one of the following:</p><ul>
<li>replicated properties</li>
<li>functions callable using remote procedure calls (RPCs)</li>
<li>replication callbacks</li>
</ul>
<p>Multiple items are grouped together into a <b>node</b>, which is then registered in replication. Once a node has been registered, list of items in it cannot be modified (items cannot be added, removed or destroyed) until the node is removed from replication. The most common node for entities and components is <code><a class="el" href="interfaceRplComponent.html">RplComponent</a></code>.</p>
<p>Each node can have a parent node and multiple child nodes, forming a <b>node hierarchy</b>. Node hierarchies can be changed dynamically, after nodes were registered in replication. This can be used for dynamically modified entity hierarchies, such as player character entering into a car and driving around in it.</p>
<p>Node hierarchies on clients may not always be present or synced up with server since a world was loaded, and process managing their presence is called <b>streaming</b>. Process of node hierarchy being created or synced up on client is called <b>streaming in</b>. The opposite process, when node hierarchy is being removed from client, is called <b>streaming out</b>.</p>
<p>Streaming on server is primarily governed by replication <b>scheduler</b>. Scheduler determines whether a node hierarchy is relevant for a client and orders it to be streamed in or out based on that. It also determines priority and frequency of replicating properties of an item, to make sure that available bandwidth is used where it matters the most. All of this depends heavily on the type of game, so scheduler is usually fine-tuned for every game to some extent. Most of the relevancy and prioritization is based on distance of an object in the game world from the player, so that closer objects are updated more often, while distant objects are updated less often or streamed out completely. However, there are also more abstract concepts in games (such faction-specific data), which require different rules for determining relevancy. Scheduler provides means for game to implement these custom rules as necessary.</p>
<h2><a class="anchor" id="RplDocs_BigPicture_Implications"></a>
Architecture implications</h2>
<p>Because node hierarchy is the unit of streaming (in general, whole node hierarchy is either streamed in or out on a particular client), it is very important to take it into consideration when thinking about architecture of various systems. Specifically, we want to make sure that client gets some information only when it is really necessary.</p>
<p>Let's say a player is part of a team that is spread out over the game world. We would like to implement a map UI that allows this player to see where in the world all of their teammates are right now. Positions of all team members are updated in real-time as they move around. This map is only visible when player opens it, it is not a minimap that is always present in the corner of the HUD.</p>
<p>An obvious approach would be to just use positions of characters of each team member and draw markers on the map corresponding to those positions. This may appear to work correctly at first, but as soon as one of the team members goes far enough and their character streams out, their marker on the map will also disappear.</p>
<p>To address that, one could set things up in scheduler so that team members are always relevant for each other. This way, no matter how far away they move from each other, they will always know where rest of their team members are. This addresses the problem with missing markers on the map and, for some games, this may be good enough. However, there are several problems with this approach:</p><ul>
<li>Single character is far more than just its position. By making all of it relevant, we replicate also changes to its equipment, animations, and anything else that is necessary for a character in 3D scene. However, for distant characters we only need their 2D position on the map.</li>
<li>We only need this information when the map is open.</li>
</ul>
<p>Ideal solution decouples streaming of data needed for map display from data needed for animated character in 3D world. Because node hierarchy is streamed as a whole, this requirement forces us to replicate these things using independent node hierarchies. Character data will continue to have relevancy based on location in the world, so that their impact is reduced as they get further away. For map indicators, when player opens the map, client makes a request to the server, showing interest in data for map indicators. Server then makes map indicators relevant for this particular client, which begins replicating their state and changes. Server has to update these map indicators to reflect changes in positions of actual characters, but if none of the players have map open, these markers do not produce any network traffic and their CPU cost is minimal. Obviously, there are more improvements possible, such as quantizing marker positions, updating only when they are relevant for some client, etc. But the most important optimization, is separation of data that is only loosely related.</p>
<p>There are two ways to implement map markers in this case:</p><ol type="1">
<li>Implement each marker as a separate node.</li>
<li>Group multiple markers in a single node.</li>
</ol>
<p>Which of these two approaches is better depends on a particular problem being solved. In general, first approach is recommended. Second one may be easier to implement at first, but it may also be harder to optimize or adjust to new requirements when design changes.</p>
<h1><a class="anchor" id="RplDocs_Fundamentals"></a>
Fundamentals</h1>
<p>Now that we have described how things work overall, let us take a look at a few examples of using replication in code. We will start by looking at a simple animation that does not use replication at all. Next we will modify this animation to use replication. Finally, we will implement a more complicated system that allows multiple players to interact with it.</p>
<dl class="section note"><dt>Note</dt><dd>These examples, as well as the rest of documentation, assume reader is already familiar with entities, components and world editor. Specifically, one should already know how to:<ul>
<li>create an entity with components of specific types</li>
<li>set a property of an entity or component to particular value</li>
<li>create an entity prefab</li>
<li>organize entities in a hierarchy both in prefab and in code</li>
<li>modify an existing world or create new one for testing</li>
</ul>
</dd></dl>
<p>To make things easier to visualize, all examples will use following entity to draw a debug sphere in the world, with sphere color selected using an index:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExampleDebugShapeClass.html">RplExampleDebugShapeClass</a>: <a class="code hl_interface" href="interfaceGenericEntityClass.html">GenericEntityClass</a> {}</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExampleDebugShapeClass.html">RplExampleDebugShapeClass</a> g_RplExampleDebugShapeClassInst;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a> : <a class="code hl_interface" href="interfaceGenericEntity.html">GenericEntity</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a> = 4;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a1dc6deed3ebe922e9cee5b692d763b92">COLORS</a>[] = {</div>
<div class="line">        <a class="code hl_interface" href="interfaceColor.html">Color</a>.<a class="code hl_variable" href="interfaceColor.html#a0cfbf64822089e4c3b0e5a6d55127208">BLACK</a>,</div>
<div class="line">        <a class="code hl_interface" href="interfaceColor.html">Color</a>.<a class="code hl_variable" href="interfaceColor.html#a8a90f4388fa241bd43e4d0c14393255c">RED</a>,</div>
<div class="line">        <a class="code hl_interface" href="interfaceColor.html">Color</a>.<a class="code hl_variable" href="interfaceColor.html#a69f1e4ac843b7d07fa93424f05b4da06">GREEN</a>,</div>
<div class="line">        <a class="code hl_interface" href="interfaceColor.html">Color</a>.<a class="code hl_variable" href="interfaceColor.html#af4892472d9601accbc151d62ad0cdb50">BLUE</a>,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> m_Color;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>(<a class="code hl_interface" href="interfaceIEntitySource.html">IEntitySource</a> src, <a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> parent)</div>
<div class="line">    {</div>
<div class="line">        this.<a class="code hl_function" href="interfaceIEntity.html#a950fc432d60ad8efab088d0a52381fd2">SetEventMask</a>(<a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FRAME);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExampleDebugShape.html#aff6ce7cc1c700604f5ff286a2f593e98">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_interface" href="interfacevector.html">vector</a> worldTransform[4];</div>
<div class="line">        this.<a class="code hl_function" href="interfaceIEntity.html#a96950154cff9096b85a77e4dab388e52">GetWorldTransform</a>(worldTransform);</div>
<div class="line">        <a class="code hl_interface" href="interfaceShape.html">Shape</a>.<a class="code hl_function" href="interfaceShape.html#add6027ab699134dcb3e0d73c0bbf1546">CreateSphere</a>(m_Color, <a class="code hl_enumeration" href="group__Debug.html#gae99018d13c3c8a3cc164600046082d04">ShapeFlags</a>.ONCE, worldTransform[3], 0.5);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(<span class="keywordtype">int</span> colorIdx)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (colorIdx &lt; 0 || colorIdx &gt;= <a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a>)</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        m_Color = <a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a1dc6deed3ebe922e9cee5b692d763b92">COLORS</a>[colorIdx];</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Debug_html_gae99018d13c3c8a3cc164600046082d04"><div class="ttname"><a href="group__Debug.html#gae99018d13c3c8a3cc164600046082d04">ShapeFlags</a></div><div class="ttdeci">ShapeFlags</div><div class="ttdef"><b>Definition:</b> ShapeFlags.c:13</div></div>
<div class="ttc" id="agroup__Entities_html_gaa29339063b04471895b3cb38b17cdb13"><div class="ttname"><a href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a></div><div class="ttdeci">EntityEvent</div><div class="ttdoc">Various entity events.</div><div class="ttdef"><b>Definition:</b> EntityEvent.c:14</div></div>
<div class="ttc" id="ainterfaceColor_html"><div class="ttname"><a href="interfaceColor.html">Color</a></div><div class="ttdef"><b>Definition:</b> Color.c:13</div></div>
<div class="ttc" id="ainterfaceColor_html_a0cfbf64822089e4c3b0e5a6d55127208"><div class="ttname"><a href="interfaceColor.html#a0cfbf64822089e4c3b0e5a6d55127208">Color.BLACK</a></div><div class="ttdeci">static const int BLACK</div><div class="ttdoc">color constants - hex codes</div><div class="ttdef"><b>Definition:</b> Color.c:15</div></div>
<div class="ttc" id="ainterfaceColor_html_a69f1e4ac843b7d07fa93424f05b4da06"><div class="ttname"><a href="interfaceColor.html#a69f1e4ac843b7d07fa93424f05b4da06">Color.GREEN</a></div><div class="ttdeci">static const int GREEN</div><div class="ttdef"><b>Definition:</b> Color.c:21</div></div>
<div class="ttc" id="ainterfaceColor_html_a8a90f4388fa241bd43e4d0c14393255c"><div class="ttname"><a href="interfaceColor.html#a8a90f4388fa241bd43e4d0c14393255c">Color.RED</a></div><div class="ttdeci">static const int RED</div><div class="ttdef"><b>Definition:</b> Color.c:20</div></div>
<div class="ttc" id="ainterfaceColor_html_af4892472d9601accbc151d62ad0cdb50"><div class="ttname"><a href="interfaceColor.html#af4892472d9601accbc151d62ad0cdb50">Color.BLUE</a></div><div class="ttdeci">static const int BLUE</div><div class="ttdef"><b>Definition:</b> Color.c:22</div></div>
<div class="ttc" id="ainterfaceGenericEntityClass_html"><div class="ttname"><a href="interfaceGenericEntityClass.html">GenericEntityClass</a></div><div class="ttdef"><b>Definition:</b> gameLibEntities.c:18</div></div>
<div class="ttc" id="ainterfaceGenericEntity_html"><div class="ttname"><a href="interfaceGenericEntity.html">GenericEntity</a></div><div class="ttdoc">Base entity class.</div><div class="ttdef"><b>Definition:</b> GenericEntity.c:16</div></div>
<div class="ttc" id="ainterfaceIEntitySource_html"><div class="ttname"><a href="interfaceIEntitySource.html">IEntitySource</a></div><div class="ttdef"><b>Definition:</b> IEntitySource.c:13</div></div>
<div class="ttc" id="ainterfaceIEntity_html"><div class="ttname"><a href="interfaceIEntity.html">IEntity</a></div><div class="ttdef"><b>Definition:</b> IEntity.c:13</div></div>
<div class="ttc" id="ainterfaceIEntity_html_a950fc432d60ad8efab088d0a52381fd2"><div class="ttname"><a href="interfaceIEntity.html#a950fc432d60ad8efab088d0a52381fd2">IEntity.SetEventMask</a></div><div class="ttdeci">proto external EntityEvent SetEventMask(EntityEvent e)</div><div class="ttdoc">Sets event mask.</div></div>
<div class="ttc" id="ainterfaceIEntity_html_a96950154cff9096b85a77e4dab388e52"><div class="ttname"><a href="interfaceIEntity.html#a96950154cff9096b85a77e4dab388e52">IEntity.GetWorldTransform</a></div><div class="ttdeci">proto external void GetWorldTransform(out vector mat[])</div><div class="ttdoc">See IEntity::GetTransform.</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShapeClass_html"><div class="ttname"><a href="interfaceRplExampleDebugShapeClass.html">RplExampleDebugShapeClass</a></div><div class="ttdoc">[Codec example]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2008</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShape_html"><div class="ttname"><a href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2012</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShape_html_a1dc6deed3ebe922e9cee5b692d763b92"><div class="ttname"><a href="interfaceRplExampleDebugShape.html#a1dc6deed3ebe922e9cee5b692d763b92">RplExampleDebugShape.COLORS</a></div><div class="ttdeci">static const int COLORS[]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2014</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShape_html_a755f71c6ef085fb37c7224c4a9dda614"><div class="ttname"><a href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">RplExampleDebugShape.COLOR_COUNT</a></div><div class="ttdeci">static const int COLOR_COUNT</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2013</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShape_html_ab3cc38083055ad4a6faa656aca77f516"><div class="ttname"><a href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">RplExampleDebugShape.SetColorByIdx</a></div><div class="ttdeci">bool SetColorByIdx(int colorIdx)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2035</div></div>
<div class="ttc" id="ainterfaceRplExampleDebugShape_html_aff6ce7cc1c700604f5ff286a2f593e98"><div class="ttname"><a href="interfaceRplExampleDebugShape.html#aff6ce7cc1c700604f5ff286a2f593e98">RplExampleDebugShape.EOnFrame</a></div><div class="ttdeci">override void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every frame.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2028</div></div>
<div class="ttc" id="ainterfaceShape_html"><div class="ttname"><a href="interfaceShape.html">Shape</a></div><div class="ttdoc">Instance of created debug visualizer.</div><div class="ttdef"><b>Definition:</b> Shape.c:14</div></div>
<div class="ttc" id="ainterfaceShape_html_add6027ab699134dcb3e0d73c0bbf1546"><div class="ttname"><a href="interfaceShape.html#add6027ab699134dcb3e0d73c0bbf1546">Shape.CreateSphere</a></div><div class="ttdeci">static proto ref Shape CreateSphere(int color, ShapeFlags flags, vector origin, float radius)</div><div class="ttdoc">Create sphere.</div></div>
<div class="ttc" id="ainterfacevector_html"><div class="ttname"><a href="interfacevector.html">vector</a></div><div class="ttdef"><b>Definition:</b> vector.c:13</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>All classes in these examples (including entities and components) are not available by default. To try these examples yourself, you need to add them to some script file (new or existing one) and "Compile and Reload Scripts" in Script Editor, so that entities and components from the code become available.</dd></dl>
<h2><a class="anchor" id="RplDocs_Fundamentals_Ex1"></a>
Example animation without replication</h2>
<p>Our first example will be simple animation that changes color of our shape over time. We will switch to next color every couple of seconds and, after reaching last color, we will wrap around and continue from the first one. All of the example code is implemented in single component:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample1ComponentColorAnimClass.html">RplExample1ComponentColorAnimClass</a> : <a class="code hl_interface" href="interfaceScriptComponentClass.html">ScriptComponentClass</a> { }</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExample1ComponentColorAnimClass.html">RplExample1ComponentColorAnimClass</a> g_RplExample1ComponentColorAnimClass;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample1ComponentColorAnim.html">RplExample1ComponentColorAnim</a> : <a class="code hl_interface" href="interfaceScriptComponent.html">ScriptComponent</a></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Constant specifying how often (in seconds) to change the color index. For</span></div>
<div class="line">    <span class="comment">// example, setting this to 5 will change the color index every 5 seconds.</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> COLOR_CHANGE_PERIOD_S = 5.0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Helper variable for accumulating time (in seconds) every frame and to calculate</span></div>
<div class="line">    <span class="comment">// color index changes.</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">float</span> m_TimeAccumulator_s;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Color index currently used for drawing the sphere.</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> m_ColorIdx;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample1ComponentColorAnim.html#ad6ff3cf5e1227cf1a8a1f1fcf7c7d26c">OnPostInit</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We check whether this component is attached to entity of correct type and</span></div>
<div class="line">        <span class="comment">// report a problem if not. Once this test passes during initialization, we</span></div>
<div class="line">        <span class="comment">// do not need to worry about owner entity being wrong type anymore.</span></div>
<div class="line">        <span class="keyword">auto</span> shapeEnt = <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner);</div>
<div class="line">        <span class="keywordflow">if</span> (!shapeEnt)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity is of type `RplExampleDebugShape`.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We initialize shape entity to correct color.</span></div>
<div class="line">        shapeEnt.SetColorByIdx(m_ColorIdx);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We subscribe to &quot;frame&quot; events, so that we can run our logic in `EOnFrame`</span></div>
<div class="line">        <span class="comment">// event handler.</span></div>
<div class="line">        <a class="code hl_function" href="interfaceGenericComponent.html#ac14809dbdcb0567d528dc62596cfee24">SetEventMask</a>(owner, <a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FRAME);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample1ComponentColorAnim.html#a1c178e4bb598d6b3db6701a6a3f68e93">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We calculate change of color index based on time (and configured color</span></div>
<div class="line">        <span class="comment">// change period), then apply the change in color.</span></div>
<div class="line">        <span class="keywordtype">int</span> colorIdxDelta = CalculateColorIdxDelta(timeSlice);</div>
<div class="line">        ApplyColorIdxDelta(owner, colorIdxDelta);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> CalculateColorIdxDelta(<span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We first accumulate time and then calculate how many color change periods</span></div>
<div class="line">        <span class="comment">// have occurred, giving us number of colors we&#39;ve cycled through.</span></div>
<div class="line">        m_TimeAccumulator_s += timeSlice;</div>
<div class="line">        <span class="keywordtype">int</span> colorIdxDelta = m_TimeAccumulator_s / COLOR_CHANGE_PERIOD_S;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We remove full periods from the accumulator, only carrying over how much</span></div>
<div class="line">        <span class="comment">// time from current period has elapsed.</span></div>
<div class="line">        m_TimeAccumulator_s -= colorIdxDelta * COLOR_CHANGE_PERIOD_S;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> colorIdxDelta;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> ApplyColorIdxDelta(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">int</span> colorIdxDelta)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// If there is no change to color index, we do nothing.</span></div>
<div class="line">        <span class="keywordflow">if</span> (colorIdxDelta == 0)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We calculate new color index.</span></div>
<div class="line">        <span class="keywordtype">int</span> newColorIdx = (m_ColorIdx + colorIdxDelta) % <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.<a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We check also new color index, since shorter periods and lower frame-rate</span></div>
<div class="line">        <span class="comment">// may result in new and old color index values being the same.</span></div>
<div class="line">        if (newColorIdx == m_ColorIdx)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Now we can update the color index ...</span></div>
<div class="line">        m_ColorIdx = newColorIdx;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ... and set new color based on new color index value.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Debug_html_ga4080cd5485010d254548bb55ecc5522a"><div class="ttname"><a href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a></div><div class="ttdeci">proto void Print(void var, LogLevel level=LogLevel.NORMAL)</div><div class="ttdoc">Prints content of variable to console/log.</div></div>
<div class="ttc" id="agroup__Debug_html_gaca1fd1d8935433e6ba2e3918214e07f9"><div class="ttname"><a href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a></div><div class="ttdeci">LogLevel</div><div class="ttdoc">Enum with severity of the logging message.</div><div class="ttdef"><b>Definition:</b> LogLevel.c:14</div></div>
<div class="ttc" id="ainterfaceGenericComponent_html_ac14809dbdcb0567d528dc62596cfee24"><div class="ttname"><a href="interfaceGenericComponent.html#ac14809dbdcb0567d528dc62596cfee24">GenericComponent.SetEventMask</a></div><div class="ttdeci">proto external int SetEventMask(notnull IEntity owner, int mask)</div><div class="ttdoc">Sets eventmask.</div></div>
<div class="ttc" id="ainterfaceRplExample1ComponentColorAnimClass_html"><div class="ttname"><a href="interfaceRplExample1ComponentColorAnimClass.html">RplExample1ComponentColorAnimClass</a></div><div class="ttdoc">[Replication example common shape]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2047</div></div>
<div class="ttc" id="ainterfaceRplExample1ComponentColorAnim_html"><div class="ttname"><a href="interfaceRplExample1ComponentColorAnim.html">RplExample1ComponentColorAnim</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2051</div></div>
<div class="ttc" id="ainterfaceRplExample1ComponentColorAnim_html_a1c178e4bb598d6b3db6701a6a3f68e93"><div class="ttname"><a href="interfaceRplExample1ComponentColorAnim.html#a1c178e4bb598d6b3db6701a6a3f68e93">RplExample1ComponentColorAnim.EOnFrame</a></div><div class="ttdeci">override void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every frame.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2083</div></div>
<div class="ttc" id="ainterfaceRplExample1ComponentColorAnim_html_ad6ff3cf5e1227cf1a8a1f1fcf7c7d26c"><div class="ttname"><a href="interfaceRplExample1ComponentColorAnim.html#ad6ff3cf5e1227cf1a8a1f1fcf7c7d26c">RplExample1ComponentColorAnim.OnPostInit</a></div><div class="ttdeci">override void OnPostInit(IEntity owner)</div><div class="ttdoc">Event called after init when all components are initialized.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2063</div></div>
<div class="ttc" id="ainterfaceScriptComponentClass_html"><div class="ttname"><a href="interfaceScriptComponentClass.html">ScriptComponentClass</a></div><div class="ttdef"><b>Definition:</b> ScriptComponentClass.c:8</div></div>
<div class="ttc" id="ainterfaceScriptComponent_html"><div class="ttname"><a href="interfaceScriptComponent.html">ScriptComponent</a></div><div class="ttdoc">Parent class for all components created in script.</div><div class="ttdef"><b>Definition:</b> ScriptComponent.c:24</div></div>
</div><!-- fragment --><p>To see it in action, we need to place <a class="el" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a> entity in a world and attach <a class="el" href="interfaceRplExample1ComponentColorAnim.html">RplExample1ComponentColorAnim</a> component to it. After switching to play mode, you should see a sphere at the position where you placed your entity. This sphere will change color every 5 seconds, cycling through black, red, green and blue, before starting from the first color again. If for some reason you do not see this, then you should determine what is the problem before moving on.</p>
<p>If you were to try this in a multiplayer session (using Peer tool plugin), you will notice that the color of our sphere changes at different time for client and server. Furthermore, depending on multiple factors, color of the sphere is also different between client and server. Why is that? Let's break down what is happening in more detail.</p>
<p>The moment our entity is created marks the beginning of our color animation, which then advances every frame based on elapsed time. For our animation to be the same on both client and server, we need to ensure that they both create the entity at the same time, so that starting point of the animation matches. Unfortunately, this is almost never the case, so we usually see the two offset from each other.</p>
<p>There are multiple ways this can be fixed and we will look at one in <a class="el" href="Page_Replication_Overview.html#RplDocs_Fundamentals_Ex2">Example animation with replication</a>. But before we do, there is one important question worth thinking about: Does it matter? In this case, we can clearly see that client and server see different color of the sphere, which is all this example does, so the answer may obviously be "yes, it matters". But what if this was a component that creates 2 seconds-long flickering of a neon sign on random building somewhere in the background? Would it matter if one player saw it lit up for a moment while another did not? Probably not. <b>Whenever we can get away with something being simulated only locally, we should take advantage of it.</b> Networking complex systems is hard and prone to bugs, and network traffic is the most limited resource we have.</p>
<h2><a class="anchor" id="RplDocs_Fundamentals_Ex2"></a>
Example animation with replication</h2>
<p>When developing multiplayer game, it is good to differentiate between <b>simulation</b> and <b>presentation</b>. Main purpose of simulation is to simulate the game logic and things going on "under the hood": calculating damage, keeping track of character hit-points, AI making decisions, physics simulation, evaluation of victory conditions, and so on. Presentation then produces audio-visual output that players can observe. When playing game offline in single-player mode, both simulation and presentation happen together. Same is true for player hosting a listen server. A dedicated server runs only simulation, as there is no way to observe audio-visual output of the presentation. A client connected to remote server (whether listen server or dedicated server) only presents results of the simulation that is happening remotely, but does not actually simulate anything. As a rule of thumb, in a multiplayer session exactly one machine runs simulation, but all players run presentation. Primary purpose of replication is to replicate data from machine that runs simulation to all players doing presentation.</p>
<dl class="section note"><dt>Note</dt><dd>There are advanced techniques that hide network latency by trying to guess what the simulation will do using limited knowledge on the client. This is usually referred to as <b>prediction</b> because the actual simulation will happen in the future, when actions from players reach the server. For simplicity, we will ignore prediction for now.</dd></dl>
<p>To replicate our animation, we will need to do a few things:</p><ol type="1">
<li>We need to register our entity in replication.</li>
<li>We need to decide who is doing the simulation.</li>
<li>We need to identify parts that belong to simulation, presentation, and data that needs to be replicated from simulation to presentation.</li>
</ol>
<p>First change we have to make is to add an <a class="el" href="interfaceRplComponent.html">RplComponent</a> to our entity. This will register the entity and its components for replication. In short, when there is an <a class="el" href="interfaceRplComponent.html">RplComponent</a> on an entity, that entity along with its descendants in entity hierarchy will be scanned during initialization, collecting all replicated items (entities and components which are relevant for replication) and registering them.</p>
<dl class="section note"><dt>Note</dt><dd>We have simplified <a class="el" href="interfaceRplComponent.html">RplComponent</a> functionality a lot here. More in-depth description will appear later in <a class="el" href="Page_Replication_RplNode.html">RplNode</a> and <a class="el" href="Page_Replication_EntitiesAndComponents.html">Replicating entities, components and hierarchies</a> sections.</dd></dl>
<p>Next, we need to decide who is doing the simulation. As we have seen in previous example, when one or more clients join a server, an instance of our entity will be created on each of them and they will all start playing the animation independently. To make them see the same animation, we need to make one of them be the source of truth, and everyone else must follow that. When we register an item for replication, it is assigned one of two roles: authority or proxy. Exactly one instance across all machines in multiplayer session is authority and everyone else is proxy. That is exactly what we need: authority is the source of truth, and proxies follow it.</p>
<p>Finally, we need to decide what is simulation, what is presentation, and what to replicate. A good rule of thumb is to focus on presentation. What is the bare minimum needed to produce the audio-visual result we need? We are looking for something that is both small in size and doesn't change very often. Since our animation is just about changing color every couple of seconds, we could replicate the color value. However, color value is encoded as 32-bit RGBA, and every bit counts when it comes to network traffic. We know there is only limited number of colors we cycle through in our animation, so using color index might be even better, as it can be encoded in fewer bits. In our case, there are 4 possible colors, and we can encode their indices in just 2 bits. To keep this example short, we will not go that far and just stick to default. Still, advantage of using color index is that it is already available, while color value would have to be taken from <a class="el" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>. Having settled down on color index as our replicated data, it is now obvious how to divide things between simulation and presentation:</p><ul>
<li>simulation - advances time, keeps track of color change period, and calculates new color index</li>
<li>replicated data - color index</li>
<li>presentation - changing color of our debug shape using color index and rendering of debug shape</li>
</ul>
<p>After we have added <a class="el" href="interfaceRplComponent.html">RplComponent</a> to our entity, we can start making changes in code.</p>
<p>We start by saying that we want to replicate color index value from authority to proxies. We do this by decorating color index with <a class="el" href="interfaceRplProp.html" title="Property annotation attribute.">RplProp</a> attribute. This attribute also let's us specify name of function that should be invoked on proxy whenever value of the variable is updated by replication.</p>
<div class="fragment"><div class="line">    <span class="comment">// We mark color index as replicated property using RplProp attribute, making</span></div>
<div class="line">    <span class="comment">// it part of replicated state. We also say we want OnColorIdxChanged function</span></div>
<div class="line">    <span class="comment">// to be invoked whenever replication updates value of color index.</span></div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(onRplName: <span class="stringliteral">&quot;OnColorIdxChanged&quot;</span>)]</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> m_ColorIdx;</div>
<div class="ttc" id="ainterfaceRplProp_html"><div class="ttname"><a href="interfaceRplProp.html">RplProp</a></div><div class="ttdoc">Property annotation attribute.</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:43</div></div>
</div><!-- fragment --><p>Next we change the initialization. Since our simulation happens in frame event handler <code>EOnFrame</code>, we only need to receive it on authority. Proxies will be reacting to changes of color index variable. If value of that variable does not change, proxies are passive and do not consume any CPU time, which is always nice.</p>
<div class="fragment"><div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> OnPostInit(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> shapeEnt = <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner);</div>
<div class="line">        <span class="keywordflow">if</span> (!shapeEnt)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity is of type `RplExampleDebugShape`.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        shapeEnt.SetColorByIdx(m_ColorIdx);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We must belong to some RplComponent in order for replication to work.</span></div>
<div class="line">        <span class="comment">// We search for it and warn user when we can&#39;t find it.</span></div>
<div class="line">        <span class="keyword">auto</span> rplComponent = <a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>.Cast(shapeEnt.FindComponent(<a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!rplComponent)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity has an RplComponent.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We only perform simulation on the authority instance, while all proxy</span></div>
<div class="line">        <span class="comment">// instances just show result of the simulation. Therefore, we only have to</span></div>
<div class="line">        <span class="comment">// subscribe to &quot;frame&quot; events on authority, leaving proxy instances as</span></div>
<div class="line">        <span class="comment">// passive components that do something only when necessary.</span></div>
<div class="line">        <span class="keywordflow">if</span> (rplComponent.Role() == <a class="code hl_enumeration" href="group__Replication.html#ga1f65df99c1f9fd676a75eca21e7d7e46">RplRole</a>.Authority)</div>
<div class="line">        {</div>
<div class="line">            SetEventMask(owner, <a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FRAME);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="ttc" id="agroup__Replication_html_ga1f65df99c1f9fd676a75eca21e7d7e46"><div class="ttname"><a href="group__Replication.html#ga1f65df99c1f9fd676a75eca21e7d7e46">RplRole</a></div><div class="ttdeci">RplRole</div><div class="ttdoc">Role of replicated node (and all items in it) within the replication system.</div><div class="ttdef"><b>Definition:</b> RplRole.c:14</div></div>
<div class="ttc" id="ainterfaceBaseRplComponent_html"><div class="ttname"><a href="interfaceBaseRplComponent.html">BaseRplComponent</a></div><div class="ttdef"><b>Definition:</b> BaseRplComponent.c:73</div></div>
</div><!-- fragment --><p>We use <a class="el" href="interfaceRplComponent.html">RplComponent</a> to determine our role in replication. We also warn the user when <a class="el" href="interfaceRplComponent.html">RplComponent</a> is missing on our entity as we currently require it to work correctly.</p>
<dl class="section note"><dt>Note</dt><dd>To keep these examples game-independent, we use <a class="el" href="interfaceBaseRplComponent.html">BaseRplComponent</a>, which is base class of game-specific <a class="el" href="interfaceRplComponent.html">RplComponent</a>.</dd></dl>
<p>Finally, we need to modify our code for updating color index, so it changes color on both authority and proxies.</p>
<div class="fragment"><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> ApplyColorIdxDelta(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">int</span> colorIdxDelta)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (colorIdxDelta == 0)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> newColorIdx = (m_ColorIdx + colorIdxDelta) % <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.<a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a>;</div>
<div class="line">        if (newColorIdx == m_ColorIdx)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update replicated state with results from the simulation.</span></div>
<div class="line">        m_ColorIdx = newColorIdx;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// After we have written new value of color index, we let replication know</span></div>
<div class="line">        <span class="comment">// that there are changes in our state that need to be replicated to proxies.</span></div>
<div class="line">        <span class="comment">// Without this call, even if we change our color index, new value would not</span></div>
<div class="line">        <span class="comment">// be replicated to proxies.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceReplication.html">Replication</a>.<a class="code hl_function" href="interfaceReplication.html#a5735f0d4b62383dbeab33c22a127abb4">BumpMe</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Presentation of replicated state on authority.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Presentation of replicated state on proxy.</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> OnColorIdxChanged()</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(GetOwner()).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="ttc" id="ainterfaceReplication_html"><div class="ttname"><a href="interfaceReplication.html">Replication</a></div><div class="ttdoc">Main replication API.</div><div class="ttdef"><b>Definition:</b> Replication.c:14</div></div>
<div class="ttc" id="ainterfaceReplication_html_a5735f0d4b62383dbeab33c22a127abb4"><div class="ttname"><a href="interfaceReplication.html#a5735f0d4b62383dbeab33c22a127abb4">Replication.BumpMe</a></div><div class="ttdeci">static proto void BumpMe()</div><div class="ttdoc">Notifies replication systems about changes in your object and queues him for replication in near futu...</div></div>
</div><!-- fragment --><p>And here is the full example code:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample2ComponentColorAnimClass.html">RplExample2ComponentColorAnimClass</a> : <a class="code hl_interface" href="interfaceScriptComponentClass.html">ScriptComponentClass</a> { }</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExample2ComponentColorAnimClass.html">RplExample2ComponentColorAnimClass</a> g_RplExample2ComponentColorAnimClass;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample2ComponentColorAnim.html">RplExample2ComponentColorAnim</a> : <a class="code hl_interface" href="interfaceScriptComponent.html">ScriptComponent</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> COLOR_CHANGE_PERIOD_S = 5.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">float</span> m_TimeAccumulator_s;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We mark color index as replicated property using RplProp attribute, making</span></div>
<div class="line">    <span class="comment">// it part of replicated state. We also say we want OnColorIdxChanged function</span></div>
<div class="line">    <span class="comment">// to be invoked whenever replication updates value of color index.</span></div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(onRplName: <span class="stringliteral">&quot;OnColorIdxChanged&quot;</span>)]</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> m_ColorIdx;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample2ComponentColorAnim.html#ac22c1b85d7e3ef245b0f83be862a8cd7">OnPostInit</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> shapeEnt = <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner);</div>
<div class="line">        <span class="keywordflow">if</span> (!shapeEnt)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity is of type `RplExampleDebugShape`.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        shapeEnt.SetColorByIdx(m_ColorIdx);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We must belong to some RplComponent in order for replication to work.</span></div>
<div class="line">        <span class="comment">// We search for it and warn user when we can&#39;t find it.</span></div>
<div class="line">        <span class="keyword">auto</span> rplComponent = <a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>.Cast(shapeEnt.FindComponent(<a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!rplComponent)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity has an RplComponent.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We only perform simulation on the authority instance, while all proxy</span></div>
<div class="line">        <span class="comment">// instances just show result of the simulation. Therefore, we only have to</span></div>
<div class="line">        <span class="comment">// subscribe to &quot;frame&quot; events on authority, leaving proxy instances as</span></div>
<div class="line">        <span class="comment">// passive components that do something only when necessary.</span></div>
<div class="line">        <span class="keywordflow">if</span> (rplComponent.Role() == <a class="code hl_enumeration" href="group__Replication.html#ga1f65df99c1f9fd676a75eca21e7d7e46">RplRole</a>.Authority)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="interfaceGenericComponent.html#ac14809dbdcb0567d528dc62596cfee24">SetEventMask</a>(owner, <a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FRAME);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample2ComponentColorAnim.html#aa9437a3ef0e10769a6daccef1640beaa">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> colorIdxDelta = CalculateColorIdxDelta(timeSlice);</div>
<div class="line">        ApplyColorIdxDelta(owner, colorIdxDelta);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> CalculateColorIdxDelta(<span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        m_TimeAccumulator_s += timeSlice;</div>
<div class="line">        <span class="keywordtype">int</span> colorIdxDelta = m_TimeAccumulator_s / COLOR_CHANGE_PERIOD_S;</div>
<div class="line">        m_TimeAccumulator_s -= colorIdxDelta * COLOR_CHANGE_PERIOD_S;</div>
<div class="line">        <span class="keywordflow">return</span> colorIdxDelta;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> ApplyColorIdxDelta(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">int</span> colorIdxDelta)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (colorIdxDelta == 0)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> newColorIdx = (m_ColorIdx + colorIdxDelta) % <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.<a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a>;</div>
<div class="line">        if (newColorIdx == m_ColorIdx)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update replicated state with results from the simulation.</span></div>
<div class="line">        m_ColorIdx = newColorIdx;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// After we have written new value of color index, we let replication know</span></div>
<div class="line">        <span class="comment">// that there are changes in our state that need to be replicated to proxies.</span></div>
<div class="line">        <span class="comment">// Without this call, even if we change our color index, new value would not</span></div>
<div class="line">        <span class="comment">// be replicated to proxies.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceReplication.html">Replication</a>.<a class="code hl_function" href="interfaceReplication.html#a5735f0d4b62383dbeab33c22a127abb4">BumpMe</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Presentation of replicated state on authority.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Presentation of replicated state on proxy.</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> OnColorIdxChanged()</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(<a class="code hl_function" href="interfaceScriptComponent.html#a38bc2b3c12cc76d24255a7c895361de0">GetOwner</a>()).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ainterfaceRplExample2ComponentColorAnimClass_html"><div class="ttname"><a href="interfaceRplExample2ComponentColorAnimClass.html">RplExample2ComponentColorAnimClass</a></div><div class="ttdoc">[Replication example 1]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2129</div></div>
<div class="ttc" id="ainterfaceRplExample2ComponentColorAnim_html"><div class="ttname"><a href="interfaceRplExample2ComponentColorAnim.html">RplExample2ComponentColorAnim</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2133</div></div>
<div class="ttc" id="ainterfaceRplExample2ComponentColorAnim_html_aa9437a3ef0e10769a6daccef1640beaa"><div class="ttname"><a href="interfaceRplExample2ComponentColorAnim.html#aa9437a3ef0e10769a6daccef1640beaa">RplExample2ComponentColorAnim.EOnFrame</a></div><div class="ttdeci">override void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">[Replication example 2 - changes in initialization]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2178</div></div>
<div class="ttc" id="ainterfaceRplExample2ComponentColorAnim_html_ac22c1b85d7e3ef245b0f83be862a8cd7"><div class="ttname"><a href="interfaceRplExample2ComponentColorAnim.html#ac22c1b85d7e3ef245b0f83be862a8cd7">RplExample2ComponentColorAnim.OnPostInit</a></div><div class="ttdeci">override void OnPostInit(IEntity owner)</div><div class="ttdoc">[Replication example 2 - color index as replicated property]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2147</div></div>
<div class="ttc" id="ainterfaceScriptComponent_html_a38bc2b3c12cc76d24255a7c895361de0"><div class="ttname"><a href="interfaceScriptComponent.html#a38bc2b3c12cc76d24255a7c895361de0">ScriptComponent.GetOwner</a></div><div class="ttdeci">proto external GenericEntity GetOwner()</div><div class="ttdoc">Get owner entity.</div></div>
</div><!-- fragment --><p>Considering this example in isolation, things are reasonably good. It is worth mentioning that what we marked as presentation (setting color used by entity to draw the sphere) is not all of it. Truly expensive parts, rendering and audio mixing, are skipped automatically when presentation is not necessary (such as on dedicated server). If you really wanted to make sure that our presentation is only doing work when necessary, you can use <a class="el" href="interfaceRplSession.html#ab57bbb94cc108afb2b83aecb7b28d4ca" title="Current mode of the replication.">RplSession.Mode()</a> to determine whether we are running in dedicated server mode or not. In general, it is best to avoid this unless absolutely necessary.</p>
<p>In larger context of the game, if there were many of these entities placed in the world, we might start seeing constant <code>EOnFrame</code> calls on authority take significant amount of time. We could improve things with use of <a class="el" href="interfaceScriptCallQueue.html#a2827d0d4ccb90e6f7cf151914b72303d" title="adds call into the queue with given parameters and arguments (arguments are holded in memory until th...">ScriptCallQueue.CallLater()</a>, specifying delay based on our color change period. This will only work well for long color change periods (on the order of seconds) where inaccuracy introduced is not significant. However, when using very short color change periods (on the order of milliseconds) we wouldn't be able to accurately determine how many periods have passed since last call.</p>
<p>If the game also provides a replicated time value, we have another possible approach to making sure animation is in sync across all machines. We can just take this value and calculate color index from it directly. This would require either checking this replicated time periodically (such as using <code>EOnFrame</code>) on all machines, or using <a class="el" href="interfaceScriptCallQueue.html#a2827d0d4ccb90e6f7cf151914b72303d" title="adds call into the queue with given parameters and arguments (arguments are holded in memory until th...">ScriptCallQueue.CallLater()</a> with delay being an estimate of when should next color change occur. Network bandwidth cost in this case would be essentially zero for our animation. Cost of replicating time may be potentially higher, but it is constant, predictable, and it doesn't increase with number of things in the world relying on it.</p>
<h2><a class="anchor" id="RplDocs_Fundamentals_Ex3"></a>
Example system with per-player controller</h2>
<p>So far, we have seen how to make simple non-interactive animation synchronized across network, with proper distinction between simulation and presentation parts. However, games are interactive medium and players play multiplayer games to interact with others in shared virtual world. So this time we will take a look at how to let server know what a player wants to do.</p>
<p>This time, instead of having our animation change colors in predefined period, we will be changing colors in reaction to player pressing keys on the keyboard. We will also create more shapes, where each will be controlled by different key. Whenever a key corresponding to specific shape is pressed, color of the shape changes to next color in the sequence (and again, last color is followed by the first, repeating sequence from the beginning).</p>
<p>When we have multiple players interacting with objects in single shared world, one situation we need to always consider is how to resolve conflicts when two players interact with the same object in contradicting ways. In our authoritative server architecture, there are two main ways to resolve this:</p><ol type="1">
<li>At any time, at most one player is allowed to interact with the object.</li>
<li>Multiple players are allowed to interact with the object and server resolves conflicts when they happen.</li>
</ol>
<p>To allow implementing both of these approaches, replication has a concept of node ownership. A client who owns a node (which means he owns all items that belong to this node) is allowed to send messages to server. Server can give ownership of a node to client (or take it back) whenever it wants.</p>
<p>Ownership is natural fit for implementing the exclusive right to interact with an object. Let's say a player is only allowed to drive a car when they are sitting in driver's seat. Server gives them ownership over car when they get in the driver's seat and as soon as they leave, ownership is taken from them. Notice that there is clear moment when ownership is given to the client (sitting in the driver's seat) and taken from it (moving to another seat or leaving the car).</p>
<p>There are many cases where there is no natural moment when ownership change should occur. For example, when two players run up to some closed door and decide to open it. Giving ownership to client just to perform single action (opening the door), then taking it back, is unnecessarily complicated and will probably make the action feel clunky by adding extra latency. These situations are usually handled through some kind of server-side <em>system</em> which creates per-player <em>controller</em>. Ownership of the controller is given to the player and all interactions with this system happen through the controller.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3ComponentColorAnimClass.html">RplExample3ComponentColorAnimClass</a> : <a class="code hl_interface" href="interfaceScriptComponentClass.html">ScriptComponentClass</a> { }</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExample3ComponentColorAnimClass.html">RplExample3ComponentColorAnimClass</a> g_RplExample3ComponentColorAnimClass;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3ComponentColorAnim.html">RplExample3ComponentColorAnim</a> : <a class="code hl_interface" href="interfaceScriptComponent.html">ScriptComponent</a></div>
<div class="line">{</div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(onRplName: <span class="stringliteral">&quot;OnColorIdxChanged&quot;</span>)]</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> m_ColorIdx;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3ComponentColorAnim.html#a3c762e7e509dcdb1cc4a6a86c2cb1775">OnPostInit</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> shapeEnt = <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(owner);</div>
<div class="line">        <span class="keywordflow">if</span> (!shapeEnt)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity is of type `RplExampleDebugShape`.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        shapeEnt.SetColorByIdx(m_ColorIdx);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> rplComponent = <a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>.Cast(shapeEnt.FindComponent(<a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!rplComponent)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__Debug.html#ga4080cd5485010d254548bb55ecc5522a">Print</a>(<span class="stringliteral">&quot;This example requires that the entity has an RplComponent.&quot;</span>, <a class="code hl_enumeration" href="group__Debug.html#gaca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a>.WARNING);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3ComponentColorAnim.html#a3f0c77aa5125a430c2f32fd00d2db2c0">NextColor</a>()</div>
<div class="line">    {</div>
<div class="line">        m_ColorIdx = (m_ColorIdx + 1) % <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.<a class="code hl_variable" href="interfaceRplExampleDebugShape.html#a755f71c6ef085fb37c7224c4a9dda614">COLOR_COUNT</a>;</div>
<div class="line">        <a class="code hl_interface" href="interfaceReplication.html">Replication</a>.<a class="code hl_function" href="interfaceReplication.html#a5735f0d4b62383dbeab33c22a127abb4">BumpMe</a>();</div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(<a class="code hl_function" href="interfaceScriptComponent.html#a38bc2b3c12cc76d24255a7c895361de0">GetOwner</a>()).SetColorByIdx(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> OnColorIdxChanged()</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExampleDebugShape.html">RplExampleDebugShape</a>.Cast(<a class="code hl_function" href="interfaceScriptComponent.html#a38bc2b3c12cc76d24255a7c895361de0">GetOwner</a>()).<a class="code hl_function" href="interfaceRplExampleDebugShape.html#ab3cc38083055ad4a6faa656aca77f516">SetColorByIdx</a>(m_ColorIdx);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3SystemClass.html">RplExample3SystemClass</a> : <a class="code hl_interface" href="interfaceScriptComponentClass.html">ScriptComponentClass</a> { }</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExample3SystemClass.html">RplExample3SystemClass</a> g_RplExample3SystemClassInst;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3System.html">RplExample3System</a> : <a class="code hl_interface" href="interfaceScriptComponent.html">ScriptComponent</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_interface" href="interfaceResourceName.html">ResourceName</a> <a class="code hl_variable" href="interfaceRplExample3System.html#a3c04792ef19897f2f8c64e31bac1fe45">s_ControllerPrefab</a> = <span class="stringliteral">&quot;{65B426E2CD4049C3}kroslakmar/RplExampleController.et&quot;</span>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_interface" href="interfaceResourceName.html">ResourceName</a> <a class="code hl_variable" href="interfaceRplExample3System.html#a1326d4b2545303c11afb85c4b48d8aaa">s_SpherePrefab</a> = <span class="stringliteral">&quot;{1AD0012447ACCE3F}kroslakmar/RplExampleShape.et&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    ref <a class="code hl_interface" href="interfaceRplExample3SessionListener.html">RplExample3SessionListener</a> <a class="code hl_variable" href="interfaceRplExample3System.html#a65d0be79969be26c4887a2aa676161f5">m_SessionListener</a> = <span class="keyword">new</span> <a class="code hl_interface" href="interfaceRplExample3SessionListener.html">RplExample3SessionListener</a>(<span class="keyword">this</span>);</div>
<div class="line">    ref <a class="code hl_interface" href="interfacemap.html">map&lt;RplIdentity, RplExample3Controller&gt;</a> <a class="code hl_variable" href="interfaceRplExample3System.html#a415454b1f460bbd77b09f5e04cc6a148">m_Controllers</a> = <span class="keyword">new</span> <a class="code hl_interface" href="interfacemap.html">map&lt;RplIdentity, RplExample3Controller&gt;</a>();</div>
<div class="line"> </div>
<div class="line">    ref <a class="code hl_interface" href="interfacearray.html">array&lt;RplExample3ComponentColorAnim&gt;</a> <a class="code hl_variable" href="interfaceRplExample3System.html#a7a604dccfdd4f0b7ef98f869d98798a4">m_Spheres</a> = <span class="keyword">new</span> <a class="code hl_interface" href="interfacearray.html">array&lt;RplExample3ComponentColorAnim&gt;</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3System.html#a33cc09fb9e9fd08e83295c80999cf742">OnPostInit</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (g_Game.<a class="code hl_function" href="interfaceGame.html#a1679e17ad26a0733e7a23ba27e977dc7">InPlayMode</a>())</div>
<div class="line">            <a class="code hl_function" href="interfaceGenericComponent.html#ac14809dbdcb0567d528dc62596cfee24">SetEventMask</a>(owner, <a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.INIT);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3System.html#a1cf88cfa360ebb71e27835558f6f5f43">EOnInit</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner)</div>
<div class="line">    {</div>
<div class="line">        RplMode mode = <a class="code hl_interface" href="interfaceRplSession.html">RplSession</a>.<a class="code hl_function" href="interfaceRplSession.html#ab57bbb94cc108afb2b83aecb7b28d4ca">Mode</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (mode != RplMode.Client)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_interface" href="interfaceRplSession.html">RplSession</a>.<a class="code hl_function" href="interfaceRplSession.html#ac4d2b3ad8c2b4e7a5313476f8562dc12">RegisterCallbacks</a>(<a class="code hl_variable" href="interfaceRplExample3System.html#a65d0be79969be26c4887a2aa676161f5">m_SessionListener</a>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (mode == RplMode.None || mode == RplMode.Listen)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_interface" href="interfaceRplExample3Controller.html">RplExample3Controller</a> controller = <a class="code hl_function" href="interfaceRplExample3System.html#af87eafcc4b6a647cdb77d1120af8760a">NewController</a>(<a class="code hl_interface" href="interfaceRplIdentity.html">RplIdentity</a>.<a class="code hl_function" href="interfaceRplIdentity.html#a4ab84babb8067da1617597011fda188e">Local</a>());</div>
<div class="line">            controller.<a class="code hl_function" href="interfaceRplExample3Controller.html#ae8a988fa1a2001cae3c85a710f649fc4">RplGiven</a>(<span class="keyword">null</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_interface" href="interfaceResource.html">Resource</a> prefab = <a class="code hl_interface" href="interfaceResource.html">Resource</a>.<a class="code hl_function" href="interfaceResource.html#af0c50e37b35525277deed17dd6335726">Load</a>(<a class="code hl_variable" href="interfaceRplExample3System.html#a1326d4b2545303c11afb85c4b48d8aaa">s_SpherePrefab</a>);</div>
<div class="line">        <a class="code hl_interface" href="interfaceEntitySpawnParams.html">EntitySpawnParams</a> spawnParams = <span class="keyword">new</span> <a class="code hl_interface" href="interfaceEntitySpawnParams.html">EntitySpawnParams</a>();</div>
<div class="line">        spawnParams.TransformMode = ETransformMode.WORLD;</div>
<div class="line">        owner.<a class="code hl_function" href="interfaceIEntity.html#a96950154cff9096b85a77e4dab388e52">GetWorldTransform</a>(spawnParams.<a class="code hl_variable" href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">Transform</a>);</div>
<div class="line">        <span class="keywordtype">float</span> xBase = spawnParams.<a class="code hl_variable" href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">Transform</a>[3][0];</div>
<div class="line">        <span class="keywordtype">float</span> yBase = spawnParams.<a class="code hl_variable" href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">Transform</a>[3][1] + 2.0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = -1; y &lt;= 1; y++)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = -1; x &lt;= 1; x++)</div>
<div class="line">        {</div>
<div class="line">            spawnParams.<a class="code hl_variable" href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">Transform</a>[3][0] = xBase + x;</div>
<div class="line">            spawnParams.<a class="code hl_variable" href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">Transform</a>[3][1] = yBase + y;</div>
<div class="line">            <a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> ent = g_Game.<a class="code hl_function" href="interfaceGame.html#a686d3f3e47150f7e4fbe6dda39393809">SpawnEntityPrefab</a>(prefab, owner.<a class="code hl_function" href="interfaceIEntity.html#ab83ece0d274f4d9611496e9bd9d8b272">GetWorld</a>(), spawnParams);</div>
<div class="line">            <a class="code hl_variable" href="interfaceRplExample3System.html#a7a604dccfdd4f0b7ef98f869d98798a4">m_Spheres</a>.<a class="code hl_function" href="interfacearray.html#ac1d500d3ca393e575e8af02daeaba8b1">Insert</a>(<a class="code hl_interface" href="interfaceRplExample3ComponentColorAnim.html">RplExample3ComponentColorAnim</a>.Cast(</div>
<div class="line">                ent.<a class="code hl_function" href="interfaceIEntity.html#aed48142810c26bb7867d5c11e204ccd1">FindComponent</a>(<a class="code hl_interface" href="interfaceRplExample3ComponentColorAnim.html">RplExample3ComponentColorAnim</a>)</div>
<div class="line">            ));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_interface" href="interfaceRplExample3Controller.html">RplExample3Controller</a> <a class="code hl_function" href="interfaceRplExample3System.html#af87eafcc4b6a647cdb77d1120af8760a">NewController</a>(<a class="code hl_interface" href="interfaceRplIdentity.html">RplIdentity</a> identity)</div>
<div class="line">    {</div>
<div class="line">        ref <a class="code hl_interface" href="interfaceResource.html">Resource</a> controllerPrefab = <a class="code hl_interface" href="interfaceResource.html">Resource</a>.<a class="code hl_function" href="interfaceResource.html#af0c50e37b35525277deed17dd6335726">Load</a>(<a class="code hl_variable" href="interfaceRplExample3System.html#a3c04792ef19897f2f8c64e31bac1fe45">s_ControllerPrefab</a>);</div>
<div class="line">        <span class="keyword">auto</span> controller = <a class="code hl_interface" href="interfaceRplExample3Controller.html">RplExample3Controller</a>.Cast(</div>
<div class="line">            g_Game.<a class="code hl_function" href="interfaceGame.html#a686d3f3e47150f7e4fbe6dda39393809">SpawnEntityPrefab</a>(controllerPrefab, <a class="code hl_function" href="interfaceScriptComponent.html#a38bc2b3c12cc76d24255a7c895361de0">GetOwner</a>().GetWorld(), <span class="keyword">null</span>)</div>
<div class="line">        );</div>
<div class="line">        controller.m_System = <span class="keyword">this</span>;</div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3System.html#a415454b1f460bbd77b09f5e04cc6a148">m_Controllers</a>.<a class="code hl_function" href="interfacemap.html#ac49bb92edb1a52b647afe3efd799a43b">Set</a>(identity, controller);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> controller;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3System.html#ae3f2daa4062cd68c5a67707a714e91ae">DeleteController</a>(<a class="code hl_interface" href="interfaceRplIdentity.html">RplIdentity</a> identity)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> controller = <a class="code hl_variable" href="interfaceRplExample3System.html#a415454b1f460bbd77b09f5e04cc6a148">m_Controllers</a>.<a class="code hl_function" href="interfacemap.html#ab6b47885afa080a12fb1941b2f4b660f">Get</a>(identity);</div>
<div class="line">        <span class="keyword">delete</span> controller;</div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3System.html#a415454b1f460bbd77b09f5e04cc6a148">m_Controllers</a>.<a class="code hl_function" href="interfacemap.html#a3fb80f42be39d614de25c016dd38eb0e">Remove</a>(identity);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3System.html#a3369ee8e2660eb0498de3cb8e922fea7">ChangeColor</a>(<span class="keywordtype">int</span> idx)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3System.html#a7a604dccfdd4f0b7ef98f869d98798a4">m_Spheres</a>[idx].NextColor();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3SessionListener.html">RplExample3SessionListener</a>: <a class="code hl_interface" href="interfaceRplSessionCallbacks.html">RplSessionCallbacks</a></div>
<div class="line">{</div>
<div class="line">    <a class="code hl_interface" href="interfaceRplExample3System.html">RplExample3System</a> <a class="code hl_variable" href="interfaceRplExample3SessionListener.html#a8b8948320f9fe9f0ee48d9cc3f779f1a">m_System</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_interface" href="interfaceRplExample3SessionListener.html">RplExample3SessionListener</a>(<a class="code hl_interface" href="interfaceRplExample3System.html">RplExample3System</a> system)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3SessionListener.html#a8b8948320f9fe9f0ee48d9cc3f779f1a">m_System</a> = system;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3SessionListener.html#a409986231b9f8634faded619a1285125">EOnConnected</a>(<a class="code hl_interface" href="interfaceRplIdentity.html">RplIdentity</a> identity)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_interface" href="interfaceRplExample3Controller.html">RplExample3Controller</a> controller = <a class="code hl_variable" href="interfaceRplExample3SessionListener.html#a8b8948320f9fe9f0ee48d9cc3f779f1a">m_System</a>.<a class="code hl_function" href="interfaceRplExample3System.html#af87eafcc4b6a647cdb77d1120af8760a">NewController</a>(identity);</div>
<div class="line">        <span class="keyword">auto</span> rplComponent = <a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>.Cast(controller.<a class="code hl_function" href="interfaceIEntity.html#aed48142810c26bb7867d5c11e204ccd1">FindComponent</a>(<a class="code hl_interface" href="interfaceBaseRplComponent.html">BaseRplComponent</a>));</div>
<div class="line">        rplComponent.<a class="code hl_function" href="interfaceBaseRplComponent.html#a75c02eb62e43059001a5ac4a91683a52">Give</a>(identity);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3SessionListener.html#acaf043054c1f3ad43ffaa0bc736326ab">EOnDisconnected</a>(<a class="code hl_interface" href="interfaceRplIdentity.html">RplIdentity</a> identity)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3SessionListener.html#a8b8948320f9fe9f0ee48d9cc3f779f1a">m_System</a>.<a class="code hl_function" href="interfaceRplExample3System.html#ae3f2daa4062cd68c5a67707a714e91ae">DeleteController</a>(identity);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3ControllerClass.html">RplExample3ControllerClass</a> : <a class="code hl_interface" href="interfaceGenericEntityClass.html">GenericEntityClass</a> {}</div>
<div class="line"><a class="code hl_interface" href="interfaceRplExample3ControllerClass.html">RplExample3ControllerClass</a> g_RplExample3ControllerClassInst;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceRplExample3Controller.html">RplExample3Controller</a> : <a class="code hl_interface" href="interfaceGenericEntity.html">GenericEntity</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a> <a class="code hl_variable" href="interfaceRplExample3Controller.html#ad3ef80183d530186b6a80bb032730cdb">s_KeyMap</a>[] = {</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD1,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD2,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD3,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD4,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD5,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD6,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD7,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD8,</div>
<div class="line">        <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a>.KC_NUMPAD9,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_interface" href="interfaceRplExample3System.html">RplExample3System</a> <a class="code hl_variable" href="interfaceRplExample3Controller.html#a0daf021289d88283bc15d5f3332034a9">m_System</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceRplExample3Controller.html#ae8a988fa1a2001cae3c85a710f649fc4">RplGiven</a>(<a class="code hl_interface" href="interfaceScriptBitReader.html">ScriptBitReader</a> reader)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">false</span>)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="interfaceIEntity.html#a950fc432d60ad8efab088d0a52381fd2">SetEventMask</a>(<a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FRAME);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="interfaceIEntity.html#a950fc432d60ad8efab088d0a52381fd2">SetEventMask</a>(<a class="code hl_enumeration" href="group__Entities.html#gaa29339063b04471895b3cb38b17cdb13">EntityEvent</a>.FIXEDFRAME);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3Controller.html#a37c07feecb6cfa21938262614acf3923">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">foreach</span> (<span class="keywordtype">int</span> idx, <a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a> kc : <a class="code hl_variable" href="interfaceRplExample3Controller.html#ad3ef80183d530186b6a80bb032730cdb">s_KeyMap</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> keyBit = 1 &lt;&lt; idx;</div>
<div class="line">            <span class="keywordtype">bool</span> isDown = <a class="code hl_interface" href="interfaceDebug.html">Debug</a>.<a class="code hl_function" href="interfaceDebug.html#a66f8fe7e12c1fa369d90f8096ddbb43a">KeyState</a>(kc);</div>
<div class="line">            <span class="keywordtype">bool</span> wasDown = (<a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> &amp; keyBit);</div>
<div class="line">            <span class="keywordflow">if</span> (isDown &amp;&amp; !wasDown)</div>
<div class="line">                <a class="code hl_function" href="interfaceGenericEntity.html#a8792c47226e86d767a282b9a657c2e74">Rpc</a>(<a class="code hl_function" href="interfaceRplExample3Controller.html#a8ba1caee4201a2366842800ecd9ba3df">Rpc_ChangeColor_S</a>, idx);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (isDown)</div>
<div class="line">                <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> |= keyBit;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> &amp;= ~keyBit;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplRpc.html">RplRpc</a>(<a class="code hl_enumeration" href="group__Replication.html#ga57116155a1911d20a0c50019116456bc">RplChannel</a>.Reliable, <a class="code hl_enumeration" href="group__Replication.html#ga45e90935ccb94bdc16b33a5142d2db58">RplRcver</a>.Server)]</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3Controller.html#a8ba1caee4201a2366842800ecd9ba3df">Rpc_ChangeColor_S</a>(<span class="keywordtype">int</span> idx)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (idx &lt; 0 || idx &gt;= 9)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3Controller.html#a0daf021289d88283bc15d5f3332034a9">m_System</a>.<a class="code hl_function" href="interfaceRplExample3System.html#a3369ee8e2660eb0498de3cb8e922fea7">ChangeColor</a>(idx);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3Controller.html#aa7f3fb94b82f15711ce2a81943890971">EOnFixedFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> isDownMask = 0;</div>
<div class="line">        <span class="keywordtype">int</span> keyBit = 1;</div>
<div class="line">        <span class="keywordflow">foreach</span> (<a class="code hl_enumeration" href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a> kc : <a class="code hl_variable" href="interfaceRplExample3Controller.html#ad3ef80183d530186b6a80bb032730cdb">s_KeyMap</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_interface" href="interfaceDebug.html">Debug</a>.<a class="code hl_function" href="interfaceDebug.html#a66f8fe7e12c1fa369d90f8096ddbb43a">KeyState</a>(kc))</div>
<div class="line">                isDownMask |= keyBit;</div>
<div class="line"> </div>
<div class="line">            keyBit &lt;&lt;= 1;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="interfaceGenericEntity.html#a8792c47226e86d767a282b9a657c2e74">Rpc</a>(<a class="code hl_function" href="interfaceRplExample3Controller.html#a32ebd6b38f0213e10fa3291ef5365de0">Rpc_OwnerInputs_S</a>, isDownMask);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplRpc.html">RplRpc</a>(<a class="code hl_enumeration" href="group__Replication.html#ga57116155a1911d20a0c50019116456bc">RplChannel</a>.Unreliable, <a class="code hl_enumeration" href="group__Replication.html#ga45e90935ccb94bdc16b33a5142d2db58">RplRcver</a>.Server)]</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceRplExample3Controller.html#a32ebd6b38f0213e10fa3291ef5365de0">Rpc_OwnerInputs_S</a>(<span class="keywordtype">int</span> isDownMask)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> inputsChanged = <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> ^ isDownMask;</div>
<div class="line">        <span class="keywordflow">if</span> (!inputsChanged)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; 9; idx++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> keyBit = 1 &lt;&lt; idx;</div>
<div class="line">            <span class="keywordtype">bool</span> isDown = isDownMask &amp; keyBit;</div>
<div class="line">            <span class="keywordtype">bool</span> wasDown = <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> &amp; keyBit;</div>
<div class="line">            <span class="keywordflow">if</span> (isDown &amp;&amp; !wasDown)</div>
<div class="line">                <a class="code hl_variable" href="interfaceRplExample3Controller.html#a0daf021289d88283bc15d5f3332034a9">m_System</a>.<a class="code hl_function" href="interfaceRplExample3System.html#a3369ee8e2660eb0498de3cb8e922fea7">ChangeColor</a>(idx);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_variable" href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">m_IsDownMask</a> = isDownMask;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="agroup__Input_html_ga7885f47644a0388f981f416fa20389b2"><div class="ttname"><a href="group__Input.html#ga7885f47644a0388f981f416fa20389b2">KeyCode</a></div><div class="ttdeci">KeyCode</div><div class="ttdef"><b>Definition:</b> KeyCode.c:13</div></div>
<div class="ttc" id="agroup__Replication_html_ga45e90935ccb94bdc16b33a5142d2db58"><div class="ttname"><a href="group__Replication.html#ga45e90935ccb94bdc16b33a5142d2db58">RplRcver</a></div><div class="ttdeci">RplRcver</div><div class="ttdoc">Target of the RPC call.</div><div class="ttdef"><b>Definition:</b> RplRcver.c:59</div></div>
<div class="ttc" id="agroup__Replication_html_ga57116155a1911d20a0c50019116456bc"><div class="ttname"><a href="group__Replication.html#ga57116155a1911d20a0c50019116456bc">RplChannel</a></div><div class="ttdeci">RplChannel</div><div class="ttdoc">Communication channel. Reliable is guaranteed to be delivered. Unreliable not.</div><div class="ttdef"><b>Definition:</b> RplChannel.c:14</div></div>
<div class="ttc" id="ainterfaceBaseRplComponent_html_a75c02eb62e43059001a5ac4a91683a52"><div class="ttname"><a href="interfaceBaseRplComponent.html#a75c02eb62e43059001a5ac4a91683a52">BaseRplComponent.Give</a></div><div class="ttdeci">proto external void Give(RplIdentity identity)</div><div class="ttdoc">Transfers ownership of the hierarchy to given connection.</div></div>
<div class="ttc" id="ainterfaceDebug_html"><div class="ttname"><a href="interfaceDebug.html">Debug</a></div><div class="ttdef"><b>Definition:</b> Debug.c:13</div></div>
<div class="ttc" id="ainterfaceDebug_html_a66f8fe7e12c1fa369d90f8096ddbb43a"><div class="ttname"><a href="interfaceDebug.html#a66f8fe7e12c1fa369d90f8096ddbb43a">Debug.KeyState</a></div><div class="ttdeci">static proto int KeyState(KeyCode key)</div><div class="ttdoc">Gets key state.</div></div>
<div class="ttc" id="ainterfaceEntitySpawnParams_html"><div class="ttname"><a href="interfaceEntitySpawnParams.html">EntitySpawnParams</a></div><div class="ttdoc">Additional parameters for entity spawning.</div><div class="ttdef"><b>Definition:</b> gameLib.c:113</div></div>
<div class="ttc" id="ainterfaceEntitySpawnParams_html_a064c06b512b69e4687ac768fb5adc36a"><div class="ttname"><a href="interfaceEntitySpawnParams.html#a064c06b512b69e4687ac768fb5adc36a">EntitySpawnParams.Transform</a></div><div class="ttdeci">vector Transform[4]</div><div class="ttdef"><b>Definition:</b> gameLib.c:115</div></div>
<div class="ttc" id="ainterfaceGame_html_a1679e17ad26a0733e7a23ba27e977dc7"><div class="ttname"><a href="interfaceGame.html#a1679e17ad26a0733e7a23ba27e977dc7">Game.InPlayMode</a></div><div class="ttdeci">proto external bool InPlayMode()</div><div class="ttdoc">Checks if the game is in playmode (e.g.</div></div>
<div class="ttc" id="ainterfaceGame_html_a686d3f3e47150f7e4fbe6dda39393809"><div class="ttname"><a href="interfaceGame.html#a686d3f3e47150f7e4fbe6dda39393809">Game.SpawnEntityPrefab</a></div><div class="ttdeci">proto external IEntity SpawnEntityPrefab(notnull Resource templateResource, BaseWorld world=null, EntitySpawnParams params=null)</div><div class="ttdoc">Safely instantiate the entity from template (with all components) and calls EOnInit if the entity set...</div></div>
<div class="ttc" id="ainterfaceGenericEntity_html_a8792c47226e86d767a282b9a657c2e74"><div class="ttname"><a href="interfaceGenericEntity.html#a8792c47226e86d767a282b9a657c2e74">GenericEntity.Rpc</a></div><div class="ttdeci">proto void Rpc(func method, void p0=NULL, void p1=NULL, void p2=NULL, void p3=NULL, void p4=NULL, void p5=NULL, void p6=NULL, void p7=NULL)</div><div class="ttdoc">Attempts to run a remote procedure call (RPC) of this instance with parameters specified in method Rp...</div></div>
<div class="ttc" id="ainterfaceIEntity_html_ab83ece0d274f4d9611496e9bd9d8b272"><div class="ttname"><a href="interfaceIEntity.html#ab83ece0d274f4d9611496e9bd9d8b272">IEntity.GetWorld</a></div><div class="ttdeci">proto external BaseWorld GetWorld()</div></div>
<div class="ttc" id="ainterfaceIEntity_html_aed48142810c26bb7867d5c11e204ccd1"><div class="ttname"><a href="interfaceIEntity.html#aed48142810c26bb7867d5c11e204ccd1">IEntity.FindComponent</a></div><div class="ttdeci">proto external Managed FindComponent(TypeName typeName)</div><div class="ttdoc">Finds first occurance of the coresponding component.</div></div>
<div class="ttc" id="ainterfaceResourceName_html"><div class="ttname"><a href="interfaceResourceName.html">ResourceName</a></div><div class="ttdef"><b>Definition:</b> ResourceName.c:13</div></div>
<div class="ttc" id="ainterfaceResource_html"><div class="ttname"><a href="interfaceResource.html">Resource</a></div><div class="ttdoc">Object hoding reference to resource.</div><div class="ttdef"><b>Definition:</b> Resource.c:25</div></div>
<div class="ttc" id="ainterfaceResource_html_af0c50e37b35525277deed17dd6335726"><div class="ttname"><a href="interfaceResource.html#af0c50e37b35525277deed17dd6335726">Resource.Load</a></div><div class="ttdeci">static proto ref Resource Load(ResourceName name)</div><div class="ttdoc">Loads object from data, or gets it from cache.</div></div>
<div class="ttc" id="ainterfaceRplExample3ComponentColorAnimClass_html"><div class="ttname"><a href="interfaceRplExample3ComponentColorAnimClass.html">RplExample3ComponentColorAnimClass</a></div><div class="ttdoc">[Replication example 2]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2225</div></div>
<div class="ttc" id="ainterfaceRplExample3ComponentColorAnim_html"><div class="ttname"><a href="interfaceRplExample3ComponentColorAnim.html">RplExample3ComponentColorAnim</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2229</div></div>
<div class="ttc" id="ainterfaceRplExample3ComponentColorAnim_html_a3c762e7e509dcdb1cc4a6a86c2cb1775"><div class="ttname"><a href="interfaceRplExample3ComponentColorAnim.html#a3c762e7e509dcdb1cc4a6a86c2cb1775">RplExample3ComponentColorAnim.OnPostInit</a></div><div class="ttdeci">override void OnPostInit(IEntity owner)</div><div class="ttdoc">Event called after init when all components are initialized.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2233</div></div>
<div class="ttc" id="ainterfaceRplExample3ComponentColorAnim_html_a3f0c77aa5125a430c2f32fd00d2db2c0"><div class="ttname"><a href="interfaceRplExample3ComponentColorAnim.html#a3f0c77aa5125a430c2f32fd00d2db2c0">RplExample3ComponentColorAnim.NextColor</a></div><div class="ttdeci">void NextColor()</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2252</div></div>
<div class="ttc" id="ainterfaceRplExample3ControllerClass_html"><div class="ttname"><a href="interfaceRplExample3ControllerClass.html">RplExample3ControllerClass</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2363</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html"><div class="ttname"><a href="interfaceRplExample3Controller.html">RplExample3Controller</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2367</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_a0daf021289d88283bc15d5f3332034a9"><div class="ttname"><a href="interfaceRplExample3Controller.html#a0daf021289d88283bc15d5f3332034a9">RplExample3Controller.m_System</a></div><div class="ttdeci">RplExample3System m_System</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2380</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_a32ebd6b38f0213e10fa3291ef5365de0"><div class="ttname"><a href="interfaceRplExample3Controller.html#a32ebd6b38f0213e10fa3291ef5365de0">RplExample3Controller.Rpc_OwnerInputs_S</a></div><div class="ttdeci">void Rpc_OwnerInputs_S(int isDownMask)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2437</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_a3775ff2abf0cc0b51744cba44d806066"><div class="ttname"><a href="interfaceRplExample3Controller.html#a3775ff2abf0cc0b51744cba44d806066">RplExample3Controller.m_IsDownMask</a></div><div class="ttdeci">int m_IsDownMask</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2381</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_a37c07feecb6cfa21938262614acf3923"><div class="ttname"><a href="interfaceRplExample3Controller.html#a37c07feecb6cfa21938262614acf3923">RplExample3Controller.EOnFrame</a></div><div class="ttdeci">override void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every frame.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2396</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_a8ba1caee4201a2366842800ecd9ba3df"><div class="ttname"><a href="interfaceRplExample3Controller.html#a8ba1caee4201a2366842800ecd9ba3df">RplExample3Controller.Rpc_ChangeColor_S</a></div><div class="ttdeci">void Rpc_ChangeColor_S(int idx)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2414</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_aa7f3fb94b82f15711ce2a81943890971"><div class="ttname"><a href="interfaceRplExample3Controller.html#aa7f3fb94b82f15711ce2a81943890971">RplExample3Controller.EOnFixedFrame</a></div><div class="ttdeci">override void EOnFixedFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every fixed frame.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2422</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_ad3ef80183d530186b6a80bb032730cdb"><div class="ttname"><a href="interfaceRplExample3Controller.html#ad3ef80183d530186b6a80bb032730cdb">RplExample3Controller.s_KeyMap</a></div><div class="ttdeci">static const KeyCode s_KeyMap[]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2368</div></div>
<div class="ttc" id="ainterfaceRplExample3Controller_html_ae8a988fa1a2001cae3c85a710f649fc4"><div class="ttname"><a href="interfaceRplExample3Controller.html#ae8a988fa1a2001cae3c85a710f649fc4">RplExample3Controller.RplGiven</a></div><div class="ttdeci">bool RplGiven(ScriptBitReader reader)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2383</div></div>
<div class="ttc" id="ainterfaceRplExample3SessionListener_html"><div class="ttname"><a href="interfaceRplExample3SessionListener.html">RplExample3SessionListener</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2342</div></div>
<div class="ttc" id="ainterfaceRplExample3SessionListener_html_a409986231b9f8634faded619a1285125"><div class="ttname"><a href="interfaceRplExample3SessionListener.html#a409986231b9f8634faded619a1285125">RplExample3SessionListener.EOnConnected</a></div><div class="ttdeci">override void EOnConnected(RplIdentity identity)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2350</div></div>
<div class="ttc" id="ainterfaceRplExample3SessionListener_html_a8b8948320f9fe9f0ee48d9cc3f779f1a"><div class="ttname"><a href="interfaceRplExample3SessionListener.html#a8b8948320f9fe9f0ee48d9cc3f779f1a">RplExample3SessionListener.m_System</a></div><div class="ttdeci">RplExample3System m_System</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2343</div></div>
<div class="ttc" id="ainterfaceRplExample3SessionListener_html_acaf043054c1f3ad43ffaa0bc736326ab"><div class="ttname"><a href="interfaceRplExample3SessionListener.html#acaf043054c1f3ad43ffaa0bc736326ab">RplExample3SessionListener.EOnDisconnected</a></div><div class="ttdeci">override void EOnDisconnected(RplIdentity identity)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2357</div></div>
<div class="ttc" id="ainterfaceRplExample3SystemClass_html"><div class="ttname"><a href="interfaceRplExample3SystemClass.html">RplExample3SystemClass</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2265</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html"><div class="ttname"><a href="interfaceRplExample3System.html">RplExample3System</a></div><div class="ttdef"><b>Definition:</b> RplDocs.c:2269</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a1326d4b2545303c11afb85c4b48d8aaa"><div class="ttname"><a href="interfaceRplExample3System.html#a1326d4b2545303c11afb85c4b48d8aaa">RplExample3System.s_SpherePrefab</a></div><div class="ttdeci">static const ResourceName s_SpherePrefab</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2271</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a1cf88cfa360ebb71e27835558f6f5f43"><div class="ttname"><a href="interfaceRplExample3System.html#a1cf88cfa360ebb71e27835558f6f5f43">RplExample3System.EOnInit</a></div><div class="ttdeci">override void EOnInit(IEntity owner)</div><div class="ttdoc">Event after entity is allocated and initialized.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2284</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a3369ee8e2660eb0498de3cb8e922fea7"><div class="ttname"><a href="interfaceRplExample3System.html#a3369ee8e2660eb0498de3cb8e922fea7">RplExample3System.ChangeColor</a></div><div class="ttdeci">void ChangeColor(int idx)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2335</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a33cc09fb9e9fd08e83295c80999cf742"><div class="ttname"><a href="interfaceRplExample3System.html#a33cc09fb9e9fd08e83295c80999cf742">RplExample3System.OnPostInit</a></div><div class="ttdeci">override void OnPostInit(IEntity owner)</div><div class="ttdoc">Event called after init when all components are initialized.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2278</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a3c04792ef19897f2f8c64e31bac1fe45"><div class="ttname"><a href="interfaceRplExample3System.html#a3c04792ef19897f2f8c64e31bac1fe45">RplExample3System.s_ControllerPrefab</a></div><div class="ttdeci">static const ResourceName s_ControllerPrefab</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2270</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a415454b1f460bbd77b09f5e04cc6a148"><div class="ttname"><a href="interfaceRplExample3System.html#a415454b1f460bbd77b09f5e04cc6a148">RplExample3System.m_Controllers</a></div><div class="ttdeci">ref map&lt; RplIdentity, RplExample3Controller &gt; m_Controllers</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2274</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a65d0be79969be26c4887a2aa676161f5"><div class="ttname"><a href="interfaceRplExample3System.html#a65d0be79969be26c4887a2aa676161f5">RplExample3System.m_SessionListener</a></div><div class="ttdeci">ref RplExample3SessionListener m_SessionListener</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2273</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_a7a604dccfdd4f0b7ef98f869d98798a4"><div class="ttname"><a href="interfaceRplExample3System.html#a7a604dccfdd4f0b7ef98f869d98798a4">RplExample3System.m_Spheres</a></div><div class="ttdeci">ref array&lt; RplExample3ComponentColorAnim &gt; m_Spheres</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2276</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_ae3f2daa4062cd68c5a67707a714e91ae"><div class="ttname"><a href="interfaceRplExample3System.html#ae3f2daa4062cd68c5a67707a714e91ae">RplExample3System.DeleteController</a></div><div class="ttdeci">void DeleteController(RplIdentity identity)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2328</div></div>
<div class="ttc" id="ainterfaceRplExample3System_html_af87eafcc4b6a647cdb77d1120af8760a"><div class="ttname"><a href="interfaceRplExample3System.html#af87eafcc4b6a647cdb77d1120af8760a">RplExample3System.NewController</a></div><div class="ttdeci">RplExample3Controller NewController(RplIdentity identity)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:2316</div></div>
<div class="ttc" id="ainterfaceRplIdentity_html"><div class="ttname"><a href="interfaceRplIdentity.html">RplIdentity</a></div><div class="ttdoc">Replication connection identity.</div><div class="ttdef"><b>Definition:</b> RplIdentity.c:14</div></div>
<div class="ttc" id="ainterfaceRplIdentity_html_a4ab84babb8067da1617597011fda188e"><div class="ttname"><a href="interfaceRplIdentity.html#a4ab84babb8067da1617597011fda188e">RplIdentity.Local</a></div><div class="ttdeci">static proto RplIdentity Local()</div></div>
<div class="ttc" id="ainterfaceRplRpc_html"><div class="ttname"><a href="interfaceRplRpc.html">RplRpc</a></div><div class="ttdoc">RPC annotation attribute.</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:70</div></div>
<div class="ttc" id="ainterfaceRplSessionCallbacks_html"><div class="ttname"><a href="interfaceRplSessionCallbacks.html">RplSessionCallbacks</a></div><div class="ttdef"><b>Definition:</b> RplSessionCallbacks.c:7</div></div>
<div class="ttc" id="ainterfaceRplSession_html"><div class="ttname"><a href="interfaceRplSession.html">RplSession</a></div><div class="ttdef"><b>Definition:</b> RplSession.c:8</div></div>
<div class="ttc" id="ainterfaceRplSession_html_ab57bbb94cc108afb2b83aecb7b28d4ca"><div class="ttname"><a href="interfaceRplSession.html#ab57bbb94cc108afb2b83aecb7b28d4ca">RplSession.Mode</a></div><div class="ttdeci">static proto RplMode Mode()</div><div class="ttdoc">Current mode of the replication.</div></div>
<div class="ttc" id="ainterfaceRplSession_html_ac4d2b3ad8c2b4e7a5313476f8562dc12"><div class="ttname"><a href="interfaceRplSession.html#ac4d2b3ad8c2b4e7a5313476f8562dc12">RplSession.RegisterCallbacks</a></div><div class="ttdeci">static proto void RegisterCallbacks(RplSessionCallbacks callbacks)</div><div class="ttdoc">Registers callbacks for current session.</div></div>
<div class="ttc" id="ainterfaceScriptBitReader_html"><div class="ttname"><a href="interfaceScriptBitReader.html">ScriptBitReader</a></div><div class="ttdef"><b>Definition:</b> EnNetwork.c:180</div></div>
<div class="ttc" id="ainterfacearray_html"><div class="ttname"><a href="interfacearray.html">array</a></div><div class="ttdef"><b>Definition:</b> Types.c:150</div></div>
<div class="ttc" id="ainterfacearray_html_ac1d500d3ca393e575e8af02daeaba8b1"><div class="ttname"><a href="interfacearray.html#ac1d500d3ca393e575e8af02daeaba8b1">array.Insert</a></div><div class="ttdeci">proto int Insert(T value)</div><div class="ttdoc">Inserts element at the end of array.</div></div>
<div class="ttc" id="ainterfacemap_html"><div class="ttname"><a href="interfacemap.html">map</a></div><div class="ttdoc">Associative array template.</div><div class="ttdef"><b>Definition:</b> Types.c:481</div></div>
<div class="ttc" id="ainterfacemap_html_a3fb80f42be39d614de25c016dd38eb0e"><div class="ttname"><a href="interfacemap.html#a3fb80f42be39d614de25c016dd38eb0e">map.Remove</a></div><div class="ttdeci">proto bool Remove(TKey key)</div></div>
<div class="ttc" id="ainterfacemap_html_ab6b47885afa080a12fb1941b2f4b660f"><div class="ttname"><a href="interfacemap.html#ab6b47885afa080a12fb1941b2f4b660f">map.Get</a></div><div class="ttdeci">proto TValue Get(TKey key)</div><div class="ttdoc">Search for an element with the given key.</div></div>
<div class="ttc" id="ainterfacemap_html_ac49bb92edb1a52b647afe3efd799a43b"><div class="ttname"><a href="interfacemap.html#ac49bb92edb1a52b647afe3efd799a43b">map.Set</a></div><div class="ttdeci">proto void Set(TKey key, TValue value)</div><div class="ttdoc">Sets value of element with given key.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="RplDocs_Glossary"></a>
Glossary</h1>
<ul>
<li><b>Server</b> - instance of the game that has the authority over the game state</li>
<li><b>Client</b> - instance of the game that connects to server</li>
<li><b>Proxy</b> - Mirror image of an item controlled by someone else (a replica)</li>
<li><b>Item</b> - instance of a type with replicated state, RPCs or replication callbacks</li>
<li><b>State</b> - collection of properties</li>
<li><b>Property</b> - member variable of a type</li>
<li><b>RPC</b> (<em>Remote procedure call</em>) - item member function that may be invoked over network</li>
<li><b>Attribute</b> - metadata attached to a property, member function or type</li>
<li><b>Snapshot</b> - copy of state at a specific point in time</li>
<li><b>Injection</b> - process of copying state from snapshot into an item</li>
<li><b>Extraction</b> - process of copying state from an item into snapshot</li>
</ul>
<h1><a class="anchor" id="Concepts"></a>
Concepts</h1>
<p>The core idea of our Replication System is code simplification, state synchronization and rpc delivery with the least amount of boilerplate possible.</p>
<p>Single-player, server and client code should utilize the same code path with minimal differences.</p>
<p>The authority in the system is shifted towards the server. This should bring more stability and security, but it may also create more load on the server side.</p>
<p>The Replication code is completely independent of the engine generic classes such as Entities and Components. The intention is to keep everything as lightweight as possible at a slight cost of added complexity.</p>
<h1><a class="anchor" id="DataFlow"></a>
Data flow</h1>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_1.svg" width="304" height="160"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<p>Avoiding networked races and writing a secure logic is always a big challenge. Every time a race or a security breach occurs there's is a big chance that it will take a serious amount of debugging effort to track it down and fix it. Therefore we should try to avoid them by design. Replication brings set of rules of thumb and design choices that should help:</p><ul>
<li><b>Item</b> has to be <b>explicitly inserted into the replication</b>.<ul>
<li>The aim is to reduce the amount of items inserted into replication to an absolute minimum and reduce the pollution of engine types by replication code.</li>
<li>User code is the one who knows which items should and shouldn't be replicated, therefore he is the one responsible for item registration.</li>
</ul>
</li>
<li>There should always be <b>at most one <em>client</em> talking to a <em>server</em> for a given item</b>. Such <em>client</em> is the <b>owner</b> of the item.<ul>
<li>This solves questions such as "Who sent the RPC first?", "Am I safe to modify
      the items data?", "Did someone override the value before I did?".</li>
</ul>
</li>
<li><b>State</b> is always distributed <b>from server to clients</b>, never the other way around.<ul>
<li>Synchronization from the client side would bring in the "Feedback loop" problem. If client changes state on the server then who should correct this client? If the server does, it will break the client data consistency which could bring adjustment from the client invoking a synchronization back to server in an infinite loop.</li>
<li>The state synchronization is basically a free access to the memory of the receiver. Allowing the synchronization from client side would be a big security risk.</li>
<li>State adjustment from client to server can be accomplished by an RPC which makes the code more readable.</li>
</ul>
</li>
<li><b>Peer-to-Peer</b> (P2P) communication is strictly <b>forbidden</b>. Clients can only talk to server.<ul>
<li>From the security perspective the client should always protect his sensitive data and share them only with the server. Not just positions/health/ammo_count are considered sensitive information. Also the client identity and IP are something that others shouldn't be able to access. The system would have to share those just by sending such message which is a big security violation.</li>
<li>Such communication should always be performed through trusted 3rd party which is the server.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="StateReplication"></a>
State replication</h1>
<p>In order to get your properties replicated you need to <b>annotate</b> them with <b>the property attribute</b>. Once the item gets replicated all of the annotated properties will get checked for changes, extracted into snapshot and encoded into packets via the type <b>Codecs</b>. Most of the system types should have the codecs already implemented.</p>
<p>Process of state replication is roughly as follows:</p><ul>
<li>on server<ol type="1">
<li><code><a class="el" href="interfaceReplication.html#a5735f0d4b62383dbeab33c22a127abb4" title="Notifies replication systems about changes in your object and queues him for replication in near futu...">Replication.BumpMe()</a></code> is used to signal that properties of an item have changed and they need to be replicated to clients. This is up to users to do as necessary. Replication does not automatically check for changes on all registered items.</li>
<li>Replication compares replicated properties against the most recent snapshot using codec function <code>PropCompare()</code>. If codec says snapshot is the same as current state, process ends.</li>
<li>Replication creates new snapshot and uses codec function <code>Extract()</code> to copy values from instance to snapshot.</li>
<li>Snapshot is transmitted to clients as needed. This process has to deal with tracking multiple snapshots per item per connected client, join-in-progress, streaming, relevancy, etc. It often uses codec function <code>SnapCompare()</code> to determine whether two snapshots are the same. When a snapshot is finally being prepared for transmission over network, codec function <code>Encode()</code> will be used to convert snapshot into compressed form (using as few bits as possible for each value) suitable for network packet.</li>
</ol>
</li>
<li>on client<ol type="1">
<li>When new packet with compressed snapshot arrives, it is decompressed using codec function <code>Decode()</code> first.</li>
<li>Snapshots are compared using codec function <code>SnapCompare()</code> to determine whether changes have occurred.</li>
<li>Replication updates properties of replicated item using codec function <code>Inject()</code>.</li>
</ol>
</li>
</ul>
<p>Above description should give you some idea of where various codec functions fit into the state replication process, but it skips over many details. Specifically, when or if at all some codec function is called is complicated and subject to changes as replication is developed over time, so you should make no assumptions about that.</p>
<dl class="section warning"><dt>Warning</dt><dd>Injection always writes a new value into replicated property. For complex types (strings, arrays or classes), this means that a pointer to new instance overwrites previous pointer to the old one. Any data stored in the old instance that is not written during injection will be lost.</dd></dl>
<p><b>Snapshots</b> are an important part of state replication and serve to decouple extraction/injection process from encoding/decoding into network packet. Following are some of the reasons for this separation:</p><ul>
<li>They are often used in comparisons between snapshots (<code>SnapCompare()</code>) or between snapshot and item state (<code>PropCompare()</code>). Especially second type of comparison would become more expensive if data optimized for network was used, as each property would have to be decoded again during every comparison.</li>
<li>They can be encoded into network packet in full or as delta from previous state. Having original information provides more options when creating and storing delta.</li>
</ul>
<p>The property annotation can be expanded by a bit of metadata to influence the replication. You can detect that your properties were updated using <b><a class="el" href="interfaceOnRpl.html" title="OnReplication annotation attribute.">OnRpl</a></b> callback and adjust the internal state of your item. Or use a <b>Condition</b> for certain special cases where you would need more control over who will be receiving updates. You can find below examples of both.</p>
<h2><a class="anchor" id="StateReplication_Examples"></a>
Examples</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceEntityWithRplProp.html">EntityWithRplProp</a> : <a class="code hl_interface" href="interfaceGenericEntity.html">GenericEntity</a></div>
<div class="line">{</div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>()]</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_variable" href="interfaceEntityWithRplProp.html#a682d79dece0c8ce66f53fb199d3d5995">bFlag</a>;</div>
<div class="line"> </div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(onRplName: <span class="stringliteral">&quot;OnIValueChanged&quot;</span>)]</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="interfaceEntityWithRplProp.html#a1cb8e66793665d01a5b4f212661a3aa3">iValue</a>;</div>
<div class="line"> </div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(condition: <a class="code hl_enumeration" href="group__Replication.html#ga357a7b4e411f7cf113e3f371b6ece5b8">RplCondition</a>.NoOwner)]</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_variable" href="interfaceEntityWithRplProp.html#a544a3e61865516719a4b5389303f8899">fValue</a>;</div>
<div class="line"> </div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplProp.html">RplProp</a>(customConditionName: <span class="stringliteral">&quot;MyCondition&quot;</span>)]</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_variable" href="interfaceEntityWithRplProp.html#ac5ea031aa328b311ca05471bf61ce164">fCustomCondition</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceEntityWithRplProp.html#a78f7eb4b3aab25c9cf573f2940282fec">OnIValueChanged</a>()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The custom condition can be helpful in places where you know that</span></div>
<div class="line">    <span class="comment">// certain values are no longer needed on the other side. This can&#39;t be</span></div>
<div class="line">    <span class="comment">// utilized to filter out connections!</span></div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceEntityWithRplProp.html#a1c7458ca32725d3b464064189090c2e1">MyCondition</a>()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_variable" href="interfaceEntityWithRplProp.html#a682d79dece0c8ce66f53fb199d3d5995">bFlag</a>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Replication_html_ga357a7b4e411f7cf113e3f371b6ece5b8"><div class="ttname"><a href="group__Replication.html#ga357a7b4e411f7cf113e3f371b6ece5b8">RplCondition</a></div><div class="ttdeci">RplCondition</div><div class="ttdoc">Conditional replication rule. Fine grained selection of receivers.</div><div class="ttdef"><b>Definition:</b> RplCondition.c:14</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html"><div class="ttname"><a href="interfaceEntityWithRplProp.html">EntityWithRplProp</a></div><div class="ttdoc">[RplProp example]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1675</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_a1c7458ca32725d3b464064189090c2e1"><div class="ttname"><a href="interfaceEntityWithRplProp.html#a1c7458ca32725d3b464064189090c2e1">EntityWithRplProp.MyCondition</a></div><div class="ttdeci">bool MyCondition()</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1696</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_a1cb8e66793665d01a5b4f212661a3aa3"><div class="ttname"><a href="interfaceEntityWithRplProp.html#a1cb8e66793665d01a5b4f212661a3aa3">EntityWithRplProp.iValue</a></div><div class="ttdeci">int iValue</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1680</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_a544a3e61865516719a4b5389303f8899"><div class="ttname"><a href="interfaceEntityWithRplProp.html#a544a3e61865516719a4b5389303f8899">EntityWithRplProp.fValue</a></div><div class="ttdeci">float fValue</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1683</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_a682d79dece0c8ce66f53fb199d3d5995"><div class="ttname"><a href="interfaceEntityWithRplProp.html#a682d79dece0c8ce66f53fb199d3d5995">EntityWithRplProp.bFlag</a></div><div class="ttdeci">bool bFlag</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1677</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_a78f7eb4b3aab25c9cf573f2940282fec"><div class="ttname"><a href="interfaceEntityWithRplProp.html#a78f7eb4b3aab25c9cf573f2940282fec">EntityWithRplProp.OnIValueChanged</a></div><div class="ttdeci">void OnIValueChanged()</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1688</div></div>
<div class="ttc" id="ainterfaceEntityWithRplProp_html_ac5ea031aa328b311ca05471bf61ce164"><div class="ttname"><a href="interfaceEntityWithRplProp.html#ac5ea031aa328b311ca05471bf61ce164">EntityWithRplProp.fCustomCondition</a></div><div class="ttdeci">float fCustomCondition</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1686</div></div>
</div><!-- fragment --><h1><a class="anchor" id="RemoteProcedureCalls"></a>
Remote procedure calls (RPCs)</h1>
<p>This is where Replication really shines. <em>RPCs</em> are routed to receivers by ownership rules so the user does not have to look up any identifier or address. The design leads the programmer towards uniform code in most <em>Client/Server</em> scenarios.</p>
<p>On sending side, codec function <code>Extract()</code> from corresponding RPC argument is used to create snapshot of relevant properties, and codec function <code>Encode()</code> then compresses this snapshot for network packet. On receiving side, codec function <code>Decode()</code> first decompresses data from packet into snapshot, then an instance is created and filled from snapshot using codec function <code>Inject()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceEntityWithRplRpc.html">EntityWithRplRpc</a> : <a class="code hl_interface" href="interfaceGenericEntity.html">GenericEntity</a></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// This is a RPC. It has to be annotated with the RplRpc attribute.</span></div>
<div class="line">    [<a class="code hl_interface" href="interfaceRplRpc.html">RplRpc</a>(<a class="code hl_enumeration" href="group__Replication.html#ga57116155a1911d20a0c50019116456bc">RplChannel</a>.Reliable, <a class="code hl_enumeration" href="group__Replication.html#ga45e90935ccb94bdc16b33a5142d2db58">RplRcver</a>.Owner)]</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceEntityWithRplRpc.html#a7ac5fe5c6211b266b0c19118c1084629">OwnerRpc</a>(<span class="keywordtype">int</span> a)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceEntityWithRplRpc.html#a058bcee4c34e8cccec88b47a114397ed">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// The RPC has to be call via special method on the entity/component.</span></div>
<div class="line">        <a class="code hl_function" href="interfaceGenericEntity.html#a8792c47226e86d767a282b9a657c2e74">Rpc</a>(<a class="code hl_function" href="interfaceEntityWithRplRpc.html#a7ac5fe5c6211b266b0c19118c1084629">OwnerRpc</a>, 7);</div>
<div class="line">        <span class="comment">// This call can have multiple outcomes depending on the role and</span></div>
<div class="line">        <span class="comment">// ownership of this instance.</span></div>
<div class="line">        <span class="comment">// 1. If this instance is the owner the RPC will be called directly</span></div>
<div class="line">        <span class="comment">//    (the same way a method would be).</span></div>
<div class="line">        <span class="comment">// 2. This instance is the server and some client owns the instance.</span></div>
<div class="line">        <span class="comment">//    Then the RPC would be called on the owning client.</span></div>
<div class="line">        <span class="comment">// 3. This is the client that does not own the instance. Then this</span></div>
<div class="line">        <span class="comment">//    RPC would be dropped.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// You can avoid a lot of branches if you design your code around these rules.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="comment">// You can still use the RPC method the same way as you would use any other method.</span></div>
<div class="line">        <span class="comment">// In many cases this would be the best way how to unify your logic.</span></div>
<div class="line">        <a class="code hl_function" href="interfaceEntityWithRplRpc.html#a7ac5fe5c6211b266b0c19118c1084629">OwnerRpc</a>(7);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ainterfaceEntityWithRplRpc_html"><div class="ttname"><a href="interfaceEntityWithRplRpc.html">EntityWithRplRpc</a></div><div class="ttdoc">[RplRpc example]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1708</div></div>
<div class="ttc" id="ainterfaceEntityWithRplRpc_html_a058bcee4c34e8cccec88b47a114397ed"><div class="ttname"><a href="interfaceEntityWithRplRpc.html#a058bcee4c34e8cccec88b47a114397ed">EntityWithRplRpc.EOnFrame</a></div><div class="ttdeci">override void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every frame.</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1716</div></div>
<div class="ttc" id="ainterfaceEntityWithRplRpc_html_a7ac5fe5c6211b266b0c19118c1084629"><div class="ttname"><a href="interfaceEntityWithRplRpc.html#a7ac5fe5c6211b266b0c19118c1084629">EntityWithRplRpc.OwnerRpc</a></div><div class="ttdeci">void OwnerRpc(int a)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1711</div></div>
</div><!-- fragment --><h2><a class="anchor" id="RemoteProcedureCalls_RoutingTable"></a>
RPC routing table (RRT)</h2>
<p>These tables specify where will be the RPC body invoked when you call it on either Server or Client engine instance.</p>
<p>RPC invoked from the server: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Is owner   </th><th class="markdownTableHeadNone">RplRcver Server   </th><th class="markdownTableHeadNone">RplRcver Owner   </th><th class="markdownTableHeadNone">RplRcver Broadcast    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Owner   </td><td class="markdownTableBodyNone">On Server   </td><td class="markdownTableBodyNone">On Server   </td><td class="markdownTableBodyNone">On all Clients    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Not Owner   </td><td class="markdownTableBodyNone">On Server   </td><td class="markdownTableBodyNone">On Client Owner   </td><td class="markdownTableBodyNone">On all Clients   </td></tr>
</table>
<p>RPC invoke from the client: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Is owner   </th><th class="markdownTableHeadNone">RplRcver Server   </th><th class="markdownTableHeadNone">RplRcver Owner   </th><th class="markdownTableHeadNone">RplRcver Broadcast    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Owner   </td><td class="markdownTableBodyNone">On Server   </td><td class="markdownTableBodyNone">Locally   </td><td class="markdownTableBodyNone">Locally    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Not Owner   </td><td class="markdownTableBodyNone">Dropped   </td><td class="markdownTableBodyNone">Dropped   </td><td class="markdownTableBodyNone">Locally   </td></tr>
</table>
<h1><a class="anchor" id="Codecs"></a>
Codecs</h1>
<p>Replication uses codecs for various types that show up as either RPC arguments or replicated properties on items. Most system types already have codecs implemented, but when you attempt to use some user-defined type in one of these cases, you will have to implement a codec yourself. Codec consists of several static functions on user-defined type <code>T</code>:</p><ul>
<li><code>bool Extract(T instance, ScriptCtx ctx, SSnapSerializerBase snapshot)</code><ul>
<li>Extracts relevant properties from an instance of type <code>T</code> into snapshot. Opposite of <code>Inject()</code>.</li>
</ul>
</li>
<li><code>bool Inject(SSnapSerializerBase snapshot, ScriptCtx ctx, T instance)</code><ul>
<li>Injects relevant properties from snapshot into an instance of type <code>T</code>. Opposite of <code>Extract()</code>.</li>
</ul>
</li>
<li><code>void Encode(SSnapSerializerBase snapshot, ScriptCtx ctx, ScriptBitSerializer packet)</code><ul>
<li>Takes snapshot and compresses it into packet. Opposite of <code>Decode()</code>.</li>
</ul>
</li>
<li><code>bool Decode(ScriptBitSerializer packet, ScriptCtx ctx, SSnapSerializerBase snapshot)</code><ul>
<li>Takes packet and decompresses it into snapshot. Opposite of <code>Encode()</code>.</li>
</ul>
</li>
<li><code>bool SnapCompare(SSnapSerializerBase lhs, SSnapSerializerBase rhs, ScriptCtx ctx)</code><ul>
<li>Compares two snapshots to see whether they are the same or not.</li>
</ul>
</li>
<li><code>bool PropCompare(T instance, SSnapSerializerBase snapshot, ScriptCtx ctx)</code><ul>
<li>Compares instance and a snapshot to see if any property has changed enough to require new snapshot.</li>
</ul>
</li>
<li>(optional) <code>void EncodeDelta(SSnapSerializerBase oldSnapshot, SSnapSerializerBase newSnapshot, ScriptCtx ctx, ScriptBitSerializer packet)</code><ul>
<li>Produces delta-encoded packet from two snapshots. Opposite of <code>DecodeDelta()</code>.</li>
</ul>
</li>
<li>(optional) <code>void DecodeDelta(ScriptBitSerializer packet, ScriptCtx ctx, SSnapSerializerBase oldSnapshot, SSnapSerializerBase newSnapshot)</code><ul>
<li>Produces new snapshot from delta-encoded packet and an older snapshot. Opposite of <code>EncodeDelta()</code>.</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Implementing codec is a lot of extra work that is prone to bugs over time. Following are some cases where it may be better to not write codec and split user-defined type into parts instead:<ul>
<li>if a type is only ever used as an argument in one RPC</li>
<li>if the codec only uses helpers and does not do anything fancy (like reducing number of bits during encoding)</li>
<li>if you don't always encode all properties of the type</li>
</ul>
</dd></dl>
<p>Here is an example of a user-defined type <code><a class="el" href="interfaceComplexType.html" title="[Codec example]">ComplexType</a></code> and its codec functions: </p><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_interface" href="interfaceComplexType.html">ComplexType</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_variable" href="interfaceComplexType.html#a94f1787adc97b0ae4c202cd78d1b7eb6">m_Bool</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="interfaceComplexType.html#a35cfbb8c9961d5495b3d172d49f60da8">m_Int</a>;</div>
<div class="line">    <span class="keywordtype">string</span> <a class="code hl_variable" href="interfaceComplexType.html#ada61ac2a96119944bf727f86923c66a0">m_String</a>;</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_variable" href="interfaceComplexType.html#a624aaf4e205cbfa440f13c52dbee9552">m_Float</a>;</div>
<div class="line">    <a class="code hl_interface" href="interfaceWorldTimestamp.html">WorldTimestamp</a> <a class="code hl_variable" href="interfaceComplexType.html#ae18c6d617365b47ec7942cc4421f9d58">m_Timestamp</a>;</div>
<div class="line">    <a class="code hl_interface" href="interfacevector.html">vector</a> <a class="code hl_variable" href="interfaceComplexType.html#ab74bd05d5aec57b18e7f1504fdb00ea0">m_Vector</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ## Extract/Inject</span></div>
<div class="line">    <span class="comment">// Extracting data from instance into snapshot, and injecting data from snapshot to instance.</span></div>
<div class="line">    <span class="comment">// Snapshot is meant to be fast to work with, so values are left uncompressed</span></div>
<div class="line">    <span class="comment">// to avoid extra work when accessing these values.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ## Encode/Decode</span></div>
<div class="line">    <span class="comment">// Encoding snapshot into a packet and decoding snapshot from a packet.</span></div>
<div class="line">    <span class="comment">// Packets need to be as small as possible, so this process tries to reduce the</span></div>
<div class="line">    <span class="comment">// size as much as it can. Knowing what range of values can certain variable have and</span></div>
<div class="line">    <span class="comment">// encoding that range in minimum number of bits required is key. If you have</span></div>
<div class="line">    <span class="comment">// to assume full range of values is needed, you can use helpers for different</span></div>
<div class="line">    <span class="comment">// types that already implement those.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ## EncodeDelta/DecodeDelta</span></div>
<div class="line">    <span class="comment">// Optional functions for implementing encoding of snapshot differences</span></div>
<div class="line">    <span class="comment">// (delta encoding). Encoding reads from old and new snapshots and writes differences</span></div>
<div class="line">    <span class="comment">// between them into delta-encoded packet. Decoding then reads from old snapshot</span></div>
<div class="line">    <span class="comment">// and delta-encoded packet and writes new packet based on them.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceComplexType.html#ac881c45fe0eba1361bc0de0251e0b7a2">Extract</a>(<a class="code hl_interface" href="interfaceComplexType.html">ComplexType</a> instance, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> snapshot)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Fill a snapshot with values from an instance.</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a94f1787adc97b0ae4c202cd78d1b7eb6">m_Bool</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a35cfbb8c9961d5495b3d172d49f60da8">m_Int</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ada61ac2a96119944bf727f86923c66a0">m_String</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a624aaf4e205cbfa440f13c52dbee9552">m_Float</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ae18c6d617365b47ec7942cc4421f9d58">m_Timestamp</a>, 8);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ab74bd05d5aec57b18e7f1504fdb00ea0">m_Vector</a>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceComplexType.html#a54ecb5fbc5132f9104c81948acf6b2df">Inject</a>(<a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> snapshot, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceComplexType.html">ComplexType</a> instance)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Fill an instance with values from snapshot.</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a94f1787adc97b0ae4c202cd78d1b7eb6">m_Bool</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a35cfbb8c9961d5495b3d172d49f60da8">m_Int</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ada61ac2a96119944bf727f86923c66a0">m_String</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a624aaf4e205cbfa440f13c52dbee9552">m_Float</a>);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ae18c6d617365b47ec7942cc4421f9d58">m_Timestamp</a>, 8);</div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ab74bd05d5aec57b18e7f1504fdb00ea0">m_Vector</a>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceComplexType.html#a96c587a71302a9de6e60c2f140373788">Encode</a>(<a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> snapshot, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceScriptBitSerializer.html">ScriptBitSerializer</a> packet)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Read values from snapshot, encode them into smaller representation, then</span></div>
<div class="line">        <span class="comment">// write them into packet.</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a768626a25f7509bfa6d61b05a7b13167">EncodeBool</a>(packet);   <span class="comment">// m_Bool</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a99f023a3edafdcd78b6b8b0c1465c571">EncodeInt</a>(packet);    <span class="comment">// m_Int</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#aa7792e125a760ef3a1e9e86e38fc2497">EncodeString</a>(packet); <span class="comment">// m_String</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a6cefa3558139c49a9b67910577af9109">EncodeFloat</a>(packet);  <span class="comment">// m_Float</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#aa433ebeb129f1d5952fdcc4854137ca8">Serialize</a>(packet, 8); <span class="comment">// m_Timestamp</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#aa9591df35d2bc6901545ed1b266b7dbd">EncodeVector</a>(packet); <span class="comment">// m_Vector</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceComplexType.html#a442046f44d646633114fcfe8daf99c27">Decode</a>(<a class="code hl_interface" href="interfaceScriptBitSerializer.html">ScriptBitSerializer</a> packet, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> snapshot)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Read values from packet, decode them into their original representation,</span></div>
<div class="line">        <span class="comment">// then write them into snapshot.</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a693ec342cab423de719afb29018c9f6e">DecodeBool</a>(packet);   <span class="comment">// m_Bool</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a99858402239c0c545af99c473997afe0">DecodeInt</a>(packet);    <span class="comment">// m_Int</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a499748d3accc53b89b7b791437f6033a">DecodeString</a>(packet); <span class="comment">// m_String</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#ad3562a68a50b78859ba564cc8f0dc8a5">DecodeFloat</a>(packet);  <span class="comment">// m_Float</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#aa433ebeb129f1d5952fdcc4854137ca8">Serialize</a>(packet, 8); <span class="comment">// m_Timestamp</span></div>
<div class="line">        snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a519fa2fe5fe4ee15db17eb896d8b8311">DecodeVector</a>(packet); <span class="comment">// m_Vector</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceComplexType.html#a685cc6b05c92787336ee537c2ca3dc24">SnapCompare</a>(<a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> lhs, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> rhs , <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Compare two snapshots and determine whether they are the same.</span></div>
<div class="line">        <span class="comment">// We have to compare properties one-by-one, but for properties with known</span></div>
<div class="line">        <span class="comment">// length (such as primitive types bool, int, float and vector), we do multiple</span></div>
<div class="line">        <span class="comment">// comparisons in single call. However, because we do not know length of string,</span></div>
<div class="line">        <span class="comment">// we use provided function which will determine number of bytes that need</span></div>
<div class="line">        <span class="comment">// to be compared from serialized data.</span></div>
<div class="line">        <span class="keywordflow">return</span> lhs.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a6939d4bf2ee003ffbb8763ff4a9f9cf3">CompareSnapshots</a>(rhs, 4+4)   <span class="comment">// m_Bool, m_Int</span></div>
<div class="line">            &amp;&amp; lhs.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afa2594995483e183740a9ceb669d1116">CompareStringSnapshots</a>(rhs)  <span class="comment">// m_String</span></div>
<div class="line">            &amp;&amp; lhs.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a6939d4bf2ee003ffbb8763ff4a9f9cf3">CompareSnapshots</a>(rhs, 4+8+12); <span class="comment">// m_Float, m_Timestamp, m_Vector</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="interfaceComplexType.html#ae625c67d0677228c0cb6ea5b046784b3">PropCompare</a>(<a class="code hl_interface" href="interfaceComplexType.html">ComplexType</a> instance, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> snapshot, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Determine whether current values in instance are sufficiently different from</span></div>
<div class="line">        <span class="comment">// an existing snapshot that it&#39;s worth creating new one.</span></div>
<div class="line">        <span class="comment">// For float or vector values, you could use some threshold to avoid creating too</span></div>
<div class="line">        <span class="comment">// many snapshots due to tiny changes in these values.</span></div>
<div class="line">        <span class="keywordflow">return</span> snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a6b182da459bdf0bc66925d2ccb4dd65c">CompareBool</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a94f1787adc97b0ae4c202cd78d1b7eb6">m_Bool</a>)</div>
<div class="line">            &amp;&amp; snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a30a93724a9a819f1c71603afc0a16b62">CompareInt</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a35cfbb8c9961d5495b3d172d49f60da8">m_Int</a>)</div>
<div class="line">            &amp;&amp; snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a5194cacff9def25bc31cc1b3e8290faf">CompareString</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ada61ac2a96119944bf727f86923c66a0">m_String</a>)</div>
<div class="line">            &amp;&amp; snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#abfecd09b75d360b596df77b6c71fccf8">CompareFloat</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#a624aaf4e205cbfa440f13c52dbee9552">m_Float</a>)</div>
<div class="line">            &amp;&amp; snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a80512b710f75967d6619c45572a2bebd">Compare</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ae18c6d617365b47ec7942cc4421f9d58">m_Timestamp</a>, 8)</div>
<div class="line">            &amp;&amp; snapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7037b4c316fa15638824516fa41cf42c">CompareVector</a>(instance.<a class="code hl_variable" href="interfaceComplexType.html#ab74bd05d5aec57b18e7f1504fdb00ea0">m_Vector</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceComplexType.html#a1f0ddaf4ac312cadffd93f1c45ddd92b">EncodeDelta</a>(<a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> oldSnapshot, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> newSnapshot, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceScriptBitSerializer.html">ScriptBitSerializer</a> packet)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Generate packet that allows other side to produce new snapshot when it already</span></div>
<div class="line">        <span class="comment">// has old one available.</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We write new value of bool directly, as there is no way to reduce it below one bit.</span></div>
<div class="line">        <span class="comment">// We still need to read old value from old snapshot to correctly access following</span></div>
<div class="line">        <span class="comment">// properties.</span></div>
<div class="line">        <span class="keywordtype">bool</span> oldBool;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(oldBool);</div>
<div class="line">        <span class="keywordtype">bool</span> newBool;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(newBool);</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newBool, 1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We encode difference between old and new value of the int, and rely on the fact</span></div>
<div class="line">        <span class="comment">// that difference of these values requires fewer bits to encode than value itself.</span></div>
<div class="line">        <span class="keywordtype">int</span> oldInt;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(oldInt);</div>
<div class="line">        <span class="keywordtype">int</span> newInt;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(newInt);</div>
<div class="line">        <span class="keywordtype">int</span> deltaInt = newInt - oldInt;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a7bd8a4f2362a3b9b66f356512562521d">SerializeInt</a>(deltaInt);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// For remaining values (string, float, vector), we use single bit to signal whether</span></div>
<div class="line">        <span class="comment">// value has changed and we only encode their new value if it is different from</span></div>
<div class="line">        <span class="comment">// the old one.</span></div>
<div class="line">        <span class="keywordtype">string</span> oldString;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(oldString);</div>
<div class="line">        <span class="keywordtype">string</span> newString;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(newString);</div>
<div class="line">        <span class="keywordtype">bool</span> stringChanged = newString != oldString;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(stringChanged, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (stringChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a8e6c8d6299e97e76143253231bd86a5a">SerializeString</a>(newString);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">float</span> oldFloat;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(oldFloat);</div>
<div class="line">        <span class="keywordtype">float</span> newFloat;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(newFloat);</div>
<div class="line">        <span class="keywordtype">bool</span> floatChanged = newFloat != oldFloat;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(floatChanged, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (floatChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newFloat, 32);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// For timestamps, rounding of float will occur when absolute value of</span></div>
<div class="line">        <span class="comment">// difference is more than 16777216ms (~4.5 hours). Also, past certain</span></div>
<div class="line">        <span class="comment">// point, differences cannot be represented as 32-bit int either. Therefore,</span></div>
<div class="line">        <span class="comment">// once difference cannot be sent accurately, we instead send full value.</span></div>
<div class="line">        <span class="comment">// This might not be the best solution for extreme uses, but it demonstrates</span></div>
<div class="line">        <span class="comment">// how one can implement delta-encoding using domain-specific knowledge.</span></div>
<div class="line">        <a class="code hl_interface" href="interfaceWorldTimestamp.html">WorldTimestamp</a> oldTimestamp;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(oldTimestamp, 8);</div>
<div class="line">        <a class="code hl_interface" href="interfaceWorldTimestamp.html">WorldTimestamp</a> newTimestamp;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(newTimestamp, 8);</div>
<div class="line">        <span class="keywordtype">float</span> deltaMs = newTimestamp.<a class="code hl_function" href="interfaceWorldTimestamp.html#a807c5bd35770a373eb469ba3577c4c25">DiffMilliseconds</a>(oldTimestamp);</div>
<div class="line">        <span class="keywordtype">bool</span> isUsingDelta = -16777216.0 &lt;= deltaMs &amp;&amp; deltaMs &lt;= 16777216.0;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(isUsingDelta, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (isUsingDelta)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> deltaMsInt = deltaMs;</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a7bd8a4f2362a3b9b66f356512562521d">SerializeInt</a>(deltaMsInt);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newTimestamp, 64);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_interface" href="interfacevector.html">vector</a> oldVector;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(oldVector);</div>
<div class="line">        <a class="code hl_interface" href="interfacevector.html">vector</a> newVector;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(newVector);</div>
<div class="line">        <span class="keywordtype">bool</span> vectorChanged = newVector != oldVector;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(vectorChanged, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (vectorChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newVector, 96);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// More techniques are possible when modification patterns are known. For example,</span></div>
<div class="line">        <span class="comment">// when multiple properties are always modified together, they could share single</span></div>
<div class="line">        <span class="comment">// bit that would say whether there were any changes (and new values were encoded)</span></div>
<div class="line">        <span class="comment">// or not.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceComplexType.html#acb8c5b5e17f2a6a60b1b1e0938eea6ec">DecodeDelta</a>(<a class="code hl_interface" href="interfaceScriptBitSerializer.html">ScriptBitSerializer</a> packet, <a class="code hl_interface" href="interfaceScriptCtx.html">ScriptCtx</a> ctx, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> oldSnapshot, <a class="code hl_interface" href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a> newSnapshot)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Generate new snapshot using data from old snapshot and packet.</span></div>
<div class="line">        <span class="comment">// Note that even when value from old snapshot is not used because packet carries</span></div>
<div class="line">        <span class="comment">// new value, we always read it to make sure we correctly access following</span></div>
<div class="line">        <span class="comment">// properties that may not have changed.</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Bool value is read directly from packet, just as it was written.</span></div>
<div class="line">        <span class="keywordtype">bool</span> oldBool;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(oldBool);</div>
<div class="line">        <span class="keywordtype">bool</span> newBool;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newBool, 1);</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SerializeBool</a>(newBool);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// New value of int is reconstructed by applying delta to old value.</span></div>
<div class="line">        <span class="keywordtype">int</span> oldInt;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(oldInt);</div>
<div class="line">        <span class="keywordtype">int</span> deltaInt;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a7bd8a4f2362a3b9b66f356512562521d">SerializeInt</a>(deltaInt);</div>
<div class="line">        <span class="keywordtype">int</span> newInt = oldInt + deltaInt;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SerializeInt</a>(newInt);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Remaining properties are reconstructed by checking whether they changed</span></div>
<div class="line">        <span class="comment">// and either reading new value from packet, or copying old value.</span></div>
<div class="line">        <span class="keywordtype">string</span> oldString;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(oldString);</div>
<div class="line">        <span class="keywordtype">bool</span> stringChanged;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(stringChanged, 1);</div>
<div class="line">        <span class="keywordtype">string</span> newString;</div>
<div class="line">        <span class="keywordflow">if</span> (stringChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a8e6c8d6299e97e76143253231bd86a5a">SerializeString</a>(newString);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            newString = oldString;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SerializeString</a>(newString);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">float</span> oldFloat;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(oldFloat);</div>
<div class="line">        <span class="keywordtype">bool</span> floatChanged;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(floatChanged, 1);</div>
<div class="line">        <span class="keywordtype">float</span> newFloat;</div>
<div class="line">        <span class="keywordflow">if</span> (floatChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newFloat, 32);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            newFloat = oldFloat;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SerializeFloat</a>(newFloat);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_interface" href="interfaceWorldTimestamp.html">WorldTimestamp</a> oldTimestamp;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(oldTimestamp, 8);</div>
<div class="line">        <span class="keywordtype">bool</span> isUsingDelta;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(isUsingDelta, 1);</div>
<div class="line">        <a class="code hl_interface" href="interfaceWorldTimestamp.html">WorldTimestamp</a> newTimestamp;</div>
<div class="line">        <span class="keywordflow">if</span> (isUsingDelta)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> deltaMsInt;</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a7bd8a4f2362a3b9b66f356512562521d">SerializeInt</a>(deltaMsInt);</div>
<div class="line">            <span class="keywordtype">float</span> deltaMs = deltaMsInt;</div>
<div class="line">            newTimestamp = oldTimestamp.<a class="code hl_function" href="interfaceWorldTimestamp.html#aa65db140447b2f1d0303702c0a2b59a7">PlusMilliseconds</a>(deltaMs);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newTimestamp, 64);</div>
<div class="line">        }</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SerializeBytes</a>(newTimestamp, 8);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_interface" href="interfacevector.html">vector</a> oldVector;</div>
<div class="line">        oldSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(oldVector);</div>
<div class="line">        <span class="keywordtype">bool</span> vectorChanged;</div>
<div class="line">        packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(vectorChanged, 1);</div>
<div class="line">        <a class="code hl_interface" href="interfacevector.html">vector</a> newVector;</div>
<div class="line">        <span class="keywordflow">if</span> (vectorChanged)</div>
<div class="line">            packet.<a class="code hl_function" href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">Serialize</a>(newVector, 96);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            newVector = oldVector;</div>
<div class="line">        newSnapshot.<a class="code hl_function" href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SerializeVector</a>(newVector);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ainterfaceComplexType_html"><div class="ttname"><a href="interfaceComplexType.html">ComplexType</a></div><div class="ttdoc">[Codec example]</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1744</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a1f0ddaf4ac312cadffd93f1c45ddd92b"><div class="ttname"><a href="interfaceComplexType.html#a1f0ddaf4ac312cadffd93f1c45ddd92b">ComplexType.EncodeDelta</a></div><div class="ttdeci">static void EncodeDelta(SSnapSerializerBase oldSnapshot, SSnapSerializerBase newSnapshot, ScriptCtx ctx, ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1847</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a35cfbb8c9961d5495b3d172d49f60da8"><div class="ttname"><a href="interfaceComplexType.html#a35cfbb8c9961d5495b3d172d49f60da8">ComplexType.m_Int</a></div><div class="ttdeci">int m_Int</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1746</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a442046f44d646633114fcfe8daf99c27"><div class="ttname"><a href="interfaceComplexType.html#a442046f44d646633114fcfe8daf99c27">ComplexType.Decode</a></div><div class="ttdeci">static bool Decode(ScriptBitSerializer packet, ScriptCtx ctx, SSnapSerializerBase snapshot)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1807</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a54ecb5fbc5132f9104c81948acf6b2df"><div class="ttname"><a href="interfaceComplexType.html#a54ecb5fbc5132f9104c81948acf6b2df">ComplexType.Inject</a></div><div class="ttdeci">static bool Inject(SSnapSerializerBase snapshot, ScriptCtx ctx, ComplexType instance)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1783</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a624aaf4e205cbfa440f13c52dbee9552"><div class="ttname"><a href="interfaceComplexType.html#a624aaf4e205cbfa440f13c52dbee9552">ComplexType.m_Float</a></div><div class="ttdeci">float m_Float</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1748</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a685cc6b05c92787336ee537c2ca3dc24"><div class="ttname"><a href="interfaceComplexType.html#a685cc6b05c92787336ee537c2ca3dc24">ComplexType.SnapCompare</a></div><div class="ttdeci">static bool SnapCompare(SSnapSerializerBase lhs, SSnapSerializerBase rhs, ScriptCtx ctx)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1820</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a94f1787adc97b0ae4c202cd78d1b7eb6"><div class="ttname"><a href="interfaceComplexType.html#a94f1787adc97b0ae4c202cd78d1b7eb6">ComplexType.m_Bool</a></div><div class="ttdeci">bool m_Bool</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1745</div></div>
<div class="ttc" id="ainterfaceComplexType_html_a96c587a71302a9de6e60c2f140373788"><div class="ttname"><a href="interfaceComplexType.html#a96c587a71302a9de6e60c2f140373788">ComplexType.Encode</a></div><div class="ttdeci">static void Encode(SSnapSerializerBase snapshot, ScriptCtx ctx, ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1795</div></div>
<div class="ttc" id="ainterfaceComplexType_html_ab74bd05d5aec57b18e7f1504fdb00ea0"><div class="ttname"><a href="interfaceComplexType.html#ab74bd05d5aec57b18e7f1504fdb00ea0">ComplexType.m_Vector</a></div><div class="ttdeci">vector m_Vector</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1750</div></div>
<div class="ttc" id="ainterfaceComplexType_html_ac881c45fe0eba1361bc0de0251e0b7a2"><div class="ttname"><a href="interfaceComplexType.html#ac881c45fe0eba1361bc0de0251e0b7a2">ComplexType.Extract</a></div><div class="ttdeci">static bool Extract(ComplexType instance, ScriptCtx ctx, SSnapSerializerBase snapshot)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1771</div></div>
<div class="ttc" id="ainterfaceComplexType_html_acb8c5b5e17f2a6a60b1b1e0938eea6ec"><div class="ttname"><a href="interfaceComplexType.html#acb8c5b5e17f2a6a60b1b1e0938eea6ec">ComplexType.DecodeDelta</a></div><div class="ttdeci">static void DecodeDelta(ScriptBitSerializer packet, ScriptCtx ctx, SSnapSerializerBase oldSnapshot, SSnapSerializerBase newSnapshot)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1929</div></div>
<div class="ttc" id="ainterfaceComplexType_html_ada61ac2a96119944bf727f86923c66a0"><div class="ttname"><a href="interfaceComplexType.html#ada61ac2a96119944bf727f86923c66a0">ComplexType.m_String</a></div><div class="ttdeci">string m_String</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1747</div></div>
<div class="ttc" id="ainterfaceComplexType_html_ae18c6d617365b47ec7942cc4421f9d58"><div class="ttname"><a href="interfaceComplexType.html#ae18c6d617365b47ec7942cc4421f9d58">ComplexType.m_Timestamp</a></div><div class="ttdeci">WorldTimestamp m_Timestamp</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1749</div></div>
<div class="ttc" id="ainterfaceComplexType_html_ae625c67d0677228c0cb6ea5b046784b3"><div class="ttname"><a href="interfaceComplexType.html#ae625c67d0677228c0cb6ea5b046784b3">ComplexType.PropCompare</a></div><div class="ttdeci">static bool PropCompare(ComplexType instance, SSnapSerializerBase snapshot, ScriptCtx ctx)</div><div class="ttdef"><b>Definition:</b> RplDocs.c:1833</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html"><div class="ttname"><a href="interfaceSSnapSerializerBase.html">SSnapSerializerBase</a></div><div class="ttdef"><b>Definition:</b> EnNetwork.c:250</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a0d61b586ae27c36237a0d07234bfddfd"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a0d61b586ae27c36237a0d07234bfddfd">SSnapSerializerBase.SerializeInt</a></div><div class="ttdeci">void SerializeInt(inout int val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:255</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a112bd26c859d2b34541ddd4ec50ffb78"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a112bd26c859d2b34541ddd4ec50ffb78">SSnapSerializerBase.SerializeBytes</a></div><div class="ttdeci">proto void SerializeBytes(inout void data, int sizeInBytes)</div><div class="ttdoc">Serializes the data pointer. The size is the amount of bytes serialized.</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a30a93724a9a819f1c71603afc0a16b62"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a30a93724a9a819f1c71603afc0a16b62">SSnapSerializerBase.CompareInt</a></div><div class="ttdeci">bool CompareInt(int val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:330</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a499748d3accc53b89b7b791437f6033a"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a499748d3accc53b89b7b791437f6033a">SSnapSerializerBase.DecodeString</a></div><div class="ttdeci">proto void DecodeString(ScriptBitSerializer packet)</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a4d1862592c4470a73557b666d1c176e1"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a4d1862592c4470a73557b666d1c176e1">SSnapSerializerBase.SerializeBool</a></div><div class="ttdeci">void SerializeBool(inout bool val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:254</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a5194cacff9def25bc31cc1b3e8290faf"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a5194cacff9def25bc31cc1b3e8290faf">SSnapSerializerBase.CompareString</a></div><div class="ttdeci">proto bool CompareString(string val)</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a519fa2fe5fe4ee15db17eb896d8b8311"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a519fa2fe5fe4ee15db17eb896d8b8311">SSnapSerializerBase.DecodeVector</a></div><div class="ttdeci">void DecodeVector(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:305</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a6939d4bf2ee003ffbb8763ff4a9f9cf3"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a6939d4bf2ee003ffbb8763ff4a9f9cf3">SSnapSerializerBase.CompareSnapshots</a></div><div class="ttdeci">proto native bool CompareSnapshots(SSnapSerializerBase snapshot, int sizeInBytes)</div><div class="ttdoc">Compares the contents of two SnapSerialiers.</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a693ec342cab423de719afb29018c9f6e"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a693ec342cab423de719afb29018c9f6e">SSnapSerializerBase.DecodeBool</a></div><div class="ttdeci">void DecodeBool(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:266</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a6b182da459bdf0bc66925d2ccb4dd65c"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a6b182da459bdf0bc66925d2ccb4dd65c">SSnapSerializerBase.CompareBool</a></div><div class="ttdeci">bool CompareBool(bool val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:329</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a6cefa3558139c49a9b67910577af9109"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a6cefa3558139c49a9b67910577af9109">SSnapSerializerBase.EncodeFloat</a></div><div class="ttdeci">void EncodeFloat(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:286</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a7037b4c316fa15638824516fa41cf42c"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a7037b4c316fa15638824516fa41cf42c">SSnapSerializerBase.CompareVector</a></div><div class="ttdeci">bool CompareVector(vector val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:332</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a768626a25f7509bfa6d61b05a7b13167"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a768626a25f7509bfa6d61b05a7b13167">SSnapSerializerBase.EncodeBool</a></div><div class="ttdeci">void EncodeBool(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:260</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a7a3ac2d5c54128d1660ad0b17e41c4f7"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a7a3ac2d5c54128d1660ad0b17e41c4f7">SSnapSerializerBase.SerializeString</a></div><div class="ttdeci">proto void SerializeString(inout string val)</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a80512b710f75967d6619c45572a2bebd"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a80512b710f75967d6619c45572a2bebd">SSnapSerializerBase.Compare</a></div><div class="ttdeci">proto bool Compare(void data, int sizeInBytes)</div><div class="ttdoc">Compares the insides of the buffer with provided pointer (bitwise).</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a881ad9139a37f75b2af664962cb6c674"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a881ad9139a37f75b2af664962cb6c674">SSnapSerializerBase.SerializeVector</a></div><div class="ttdeci">void SerializeVector(inout vector val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:257</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a99858402239c0c545af99c473997afe0"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a99858402239c0c545af99c473997afe0">SSnapSerializerBase.DecodeInt</a></div><div class="ttdeci">void DecodeInt(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:279</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_a99f023a3edafdcd78b6b8b0c1465c571"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#a99f023a3edafdcd78b6b8b0c1465c571">SSnapSerializerBase.EncodeInt</a></div><div class="ttdeci">void EncodeInt(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:273</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_aa433ebeb129f1d5952fdcc4854137ca8"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#aa433ebeb129f1d5952fdcc4854137ca8">SSnapSerializerBase.Serialize</a></div><div class="ttdeci">proto native bool Serialize(ScriptBitSerializer serializer, int sizeInBytes)</div><div class="ttdoc">Serialization of the BitSerializer type.</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_aa7792e125a760ef3a1e9e86e38fc2497"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#aa7792e125a760ef3a1e9e86e38fc2497">SSnapSerializerBase.EncodeString</a></div><div class="ttdeci">proto void EncodeString(ScriptBitSerializer packet)</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_aa9591df35d2bc6901545ed1b266b7dbd"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#aa9591df35d2bc6901545ed1b266b7dbd">SSnapSerializerBase.EncodeVector</a></div><div class="ttdeci">void EncodeVector(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:299</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_abfecd09b75d360b596df77b6c71fccf8"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#abfecd09b75d360b596df77b6c71fccf8">SSnapSerializerBase.CompareFloat</a></div><div class="ttdeci">bool CompareFloat(float val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:331</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_ad3562a68a50b78859ba564cc8f0dc8a5"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#ad3562a68a50b78859ba564cc8f0dc8a5">SSnapSerializerBase.DecodeFloat</a></div><div class="ttdeci">void DecodeFloat(ScriptBitSerializer packet)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:292</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_afa2594995483e183740a9ceb669d1116"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#afa2594995483e183740a9ceb669d1116">SSnapSerializerBase.CompareStringSnapshots</a></div><div class="ttdeci">proto bool CompareStringSnapshots(SSnapSerializerBase snapshot)</div></div>
<div class="ttc" id="ainterfaceSSnapSerializerBase_html_afeddf6be3cce48c0a60c06ee1e0cd8ad"><div class="ttname"><a href="interfaceSSnapSerializerBase.html#afeddf6be3cce48c0a60c06ee1e0cd8ad">SSnapSerializerBase.SerializeFloat</a></div><div class="ttdeci">void SerializeFloat(inout float val)</div><div class="ttdef"><b>Definition:</b> EnNetwork.c:256</div></div>
<div class="ttc" id="ainterfaceScriptBitSerializer_html"><div class="ttname"><a href="interfaceScriptBitSerializer.html">ScriptBitSerializer</a></div><div class="ttdef"><b>Definition:</b> EnNetwork.c:220</div></div>
<div class="ttc" id="ainterfaceScriptBitSerializer_html_a6bcf6aca4642765e94b8ce032b348ece"><div class="ttname"><a href="interfaceScriptBitSerializer.html#a6bcf6aca4642765e94b8ce032b348ece">ScriptBitSerializer.Serialize</a></div><div class="ttdeci">proto bool Serialize(inout void data, int sizeInBits)</div><div class="ttdoc">Serializes the data pointer. The size is the amount of bits serialized.</div></div>
<div class="ttc" id="ainterfaceScriptBitSerializer_html_a7bd8a4f2362a3b9b66f356512562521d"><div class="ttname"><a href="interfaceScriptBitSerializer.html#a7bd8a4f2362a3b9b66f356512562521d">ScriptBitSerializer.SerializeInt</a></div><div class="ttdeci">proto bool SerializeInt(inout int val)</div></div>
<div class="ttc" id="ainterfaceScriptBitSerializer_html_a8e6c8d6299e97e76143253231bd86a5a"><div class="ttname"><a href="interfaceScriptBitSerializer.html#a8e6c8d6299e97e76143253231bd86a5a">ScriptBitSerializer.SerializeString</a></div><div class="ttdeci">proto bool SerializeString(inout string val)</div></div>
<div class="ttc" id="ainterfaceScriptCtx_html"><div class="ttname"><a href="interfaceScriptCtx.html">ScriptCtx</a></div><div class="ttdef"><b>Definition:</b> EnNetwork.c:36</div></div>
<div class="ttc" id="ainterfaceWorldTimestamp_html"><div class="ttname"><a href="interfaceWorldTimestamp.html">WorldTimestamp</a></div><div class="ttdoc">Type storing timestamps of the world.</div><div class="ttdef"><b>Definition:</b> WorldTimestamp.c:26</div></div>
<div class="ttc" id="ainterfaceWorldTimestamp_html_a807c5bd35770a373eb469ba3577c4c25"><div class="ttname"><a href="interfaceWorldTimestamp.html#a807c5bd35770a373eb469ba3577c4c25">WorldTimestamp.DiffMilliseconds</a></div><div class="ttdeci">proto external float DiffMilliseconds(WorldTimestamp other)</div></div>
<div class="ttc" id="ainterfaceWorldTimestamp_html_aa65db140447b2f1d0303702c0a2b59a7"><div class="ttname"><a href="interfaceWorldTimestamp.html#aa65db140447b2f1d0303702c0a2b59a7">WorldTimestamp.PlusMilliseconds</a></div><div class="ttdeci">proto external WorldTimestamp PlusMilliseconds(float milliseconds)</div></div>
</div><!-- fragment --><h1><a class="anchor" id="NetworkedLogic"></a>
Networked logic</h1>
<p>You will have to start thinking at a bigger scale If you want to write <b>readable and unified replication code</b>. Keep in mind that you want to reuse the most of your replication code and still keep it readable <b>for all of the application use-cases (listen server, dedicated server, single-player)</b>. This is not an easy task but trust me it will save you time and a lot of typing in the long run.</p>
<p>To give you more context about the current usage of your item the replication uses <b><a class="el" href="interfaceRplNode.html">RplNode</a></b> structures. These are immutably bound to your items and function as a proxy between your code and replication layer. I won't talk about how to create and maintain them as it will be explained in depth later on. Now they will just give us two pieces of context: <b>Role and Ownership</b>. These are the strongest tools you will get from the replication layer. Lets look at an example:</p>
<div class="fragment"><div class="line"><span class="comment">// The task is to control a car in multiplayer.</span></div>
<div class="line"><span class="keyword">class </span>CarControllerComponent : <a class="code hl_interface" href="interfaceScriptComponent.html">ScriptComponent</a></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Lets assume that we already got the node from somewhere.</span></div>
<div class="line">    <span class="keyword">private</span> <a class="code hl_interface" href="interfaceRplNode.html">RplNode</a> m_Node;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We would like our logic to fulfill following constraints.</span></div>
<div class="line">    <span class="comment">// 1. Server is in charge of the transformation of the car.</span></div>
<div class="line">    <span class="comment">// 2. The player provides input to move the car around.</span></div>
<div class="line">    <span class="comment">// 3. Everybody should see the car moving.</span></div>
<div class="line">    <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="interfaceScriptComponent.html#a374e7f14058c6344ec34b281e0924799">EOnFrame</a>(<a class="code hl_interface" href="interfaceIEntity.html">IEntity</a> owner, <span class="keywordtype">float</span> timeSlice)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Theres three parts that wee need to be handled.</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// 1. Authority (the server)</span></div>
<div class="line">        <span class="comment">// There are only two roles at the moment (Authority and Proxy).</span></div>
<div class="line">        <span class="keywordflow">if</span>(m_Node.Role() == <a class="code hl_enumeration" href="group__Replication.html#ga1f65df99c1f9fd676a75eca21e7d7e46">RplRole</a>.Authority)</div>
<div class="line">        {</div>
<div class="line">            CalculateNewTransform(...);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// 2. Owner (the driving client)</span></div>
<div class="line">        <span class="keywordflow">if</span>(m_Node.IsOwner())</div>
<div class="line">        {</div>
<div class="line">            SendInput(...);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// 3. Everybody</span></div>
<div class="line">        MoveCar(...);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> CalculateNewTransform(...)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// Calculate new target transformation based on players input.</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> SendInput(...)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (KeyDown(...))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// ...</span></div>
<div class="line">            <span class="comment">// Send to authority Throttle/Break.</span></div>
<div class="line">            <span class="comment">// ...</span></div>
<div class="line">            <span class="comment">// Send to authority Left/Right.</span></div>
<div class="line">            <span class="comment">// ...</span></div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// For authority only localy record the input.</span></div>
<div class="line">        <span class="comment">// RPCs do this automatically for you but that will be covered later.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> MoveCar(...)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// Move the car when authority provides new target transformation.</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ainterfaceRplNode_html"><div class="ttname"><a href="interfaceRplNode.html">RplNode</a></div><div class="ttdef"><b>Definition:</b> RplNode.c:13</div></div>
<div class="ttc" id="ainterfaceScriptComponent_html_a374e7f14058c6344ec34b281e0924799"><div class="ttname"><a href="interfaceScriptComponent.html#a374e7f14058c6344ec34b281e0924799">ScriptComponent.EOnFrame</a></div><div class="ttdeci">void EOnFrame(IEntity owner, float timeSlice)</div><div class="ttdoc">Event every frame.</div></div>
</div><!-- fragment --><p>Now put the above example into different settings and debug whats happening.</p>
<h2><a class="anchor" id="NetworkedLogic_Case1"></a>
Setting 1: Listen server and a client</h2>
<p>Two car instances. One owned by the server player and second owned by the client.</p><ul>
<li><b>Server and his car</b>: <code>CalculateNewTransform()</code> → <code>SendInput()</code> → <code>MoveCar()</code></li>
<li><b>Server and client's car</b>: <code>CalculateNewTransform()</code> → <code>MoveCar()</code></li>
<li><b>Client and server's car</b>: <code>MoveCar()</code></li>
<li><b>Client and his car</b>: <code>SendInput()</code> → <code>MoveCar()</code></li>
</ul>
<p>Our constraints hold for both of our instances on both sides. The server controls the transform, car owner provides input and everybody is moving both of the instances around.</p>
<h2><a class="anchor" id="NetworkedLogic_Case2"></a>
Setting 2: Dedicated server and two clients</h2>
<p>Two car instances (car1, car2). One owned by each client (client1, client2).</p><ul>
<li><b>Server car1</b>: <code>CalculateNewTransform()</code> → <code>MoveCar()</code></li>
<li><b>Server car2</b>: <code>CalculateNewTransform()</code> → <code>MoveCar()</code></li>
<li><b>Client1 car1</b>: <code>SendInput()</code> → <code>MoveCar()</code></li>
<li><b>Client1 car2</b>: <code>MoveCar()</code></li>
<li><b>Client2 car1</b>: <code>MoveCar()</code></li>
<li><b>Client2 car2</b>: <code>SendInput()</code> → <code>MoveCar()</code></li>
</ul>
<p>Once again our constraints hold for all instances on all sides. The server controls the transformations of both cars and every client can control only his own car. Everybody sees cars moving.</p>
<h2><a class="anchor" id="NetworkedLogic_Case3"></a>
Setting 3: Single-player</h2>
<p>One car on single instance ("server" that doesn't allow client connections). There is no need to call different code path or make specific changes for single-player. Roles and ownership should take care of the logic.</p><ul>
<li><b>Server</b>: <code>CalculateNewTransform()</code> → <code>SendInput()</code> → <code>MoveCar()</code></li>
</ul>
<p>As you can see there is no difference in behavior. The player would be still able to drive the car even when not running a multiplayer game.</p>
<h2><a class="anchor" id="NetworkedLogic_Takeaway"></a>
Takeaway - TLDR</h2>
<p>The replication provides you with tools to structure your networked code in minimal and readable manner.</p>
<p>There's a bit of mental gymnastics involved along with a few rules of thumb that will carry you through the process:</p><ul>
<li>Base your logic around the <b>roles and ownership</b>.</li>
<li>Your code will be running in more than one setting. <b>Verify that your assumptions</b> also work for the others.</li>
<li>Use <b>real examples</b> to reason about the design and put them into context of different settings**.</li>
<li>Before reaching out to some utility like "IsDedicatedServer()" or "IsClient()" think twice**.<ul>
<li><b>These will be available somewhere in the codebase but instead of making your job easier they will make it much much harder.</b></li>
<li><b>Think of those as usage of hardcoded constants instead of adaptible state machine.</b></li>
</ul>
</li>
<li>When you find a case where these tools don't fit then this is not your hammer. Use something else.</li>
<li><b>Always proceed with caution.</b> - <em>Nothing takes longer than fixing a bug in distributed asynchronous codebase.</em></li>
</ul>
<h1><a class="anchor" id="ItemRegistration"></a>
Item registration</h1>
<h2><a class="anchor" id="ItemRegistration_RplNode"></a>
Lightweight using enf::RplNode</h2>
<p>Any <b>enf::BaseItem</b> derived object (<b>Item</b>) can utilize the State synchronization and rpcs. We will discuss in this section how to integrate replication into the codebase and what we will get from doing so.</p><ol type="1">
<li><b>Derive</b> your classes/structs <b>from enf::BaseItem</b> and properly implement the ENF_DECLARE_ITEM(...) macro. <b>This is a crucial step! Beware!</b></li>
<li>Now you need an <b>enf::RplNode or its derived instance</b> that will serve as the container for your Items. Here you have a couple of options:<ul>
<li>Just raw <b>instantiate</b> the enf::RplNode.</li>
<li>Make the enf::RplNode <b>member</b> of one of the items.</li>
<li><b>Derive</b> one of Items from the enf::RplNode.</li>
</ul>
</li>
<li>When all of your Items are constructed and ready <b>insert them into the node</b> via his API.</li>
<li>(optional) The enf::RplNode is a hierarchical structure. You may set the <b>parent child relations</b> between your nodes at this point.</li>
<li><b>Call the self registration</b> method of the enf::RplNode <code>InsertToReplication(...)</code> (or its replacement if defined in the derived type).</li>
</ol>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_2.svg" width="510" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<p>Now you should have your items successfully registered and ready to synchronize their state and send/receive RPC messages.</p>
<p>Your items will receive the <a class="el" href="interfaceRplId.html" title="Replication item identifier.">RplId</a> (a unique identifier in the networked environment), replication role and ownership information. You should design your logic around these as they will help you to unify your code for every use-case using replication (single player, listen server, dedicated server, client).</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Node owner (first item in the node) → Creation + Destruction</dd></dl>
<h2><a class="anchor" id="ItemRegistration_RplComponent"></a>
Entity system using gamelib::BaseRplComponent</h2>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>ease of use and relation to <a class="el" href="interfaceRplNode.html">RplNode</a> ...</dd></dl>
<h1><a class="anchor" id="Streaming"></a>
Streaming</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Item creation, destruction, hierarchy and overall lifetime in replication. (The complicated stuff ...)</dd></dl>
<h1><a class="anchor" id="LifeCycle"></a>
Life cycle</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>draw</dd></dl>
<h1><a class="anchor" id="Caveats"></a>
Caveats</h1>
<ul>
<li>When running multiple instances of the GameApp with -forceupdate flag on the same machine consider using also -maxFPS XX flag to balance out the load of both instances. Otherwise you could end up with foreground instance running at 200 fps and the background instance at 5fps because of the operating system prioritization. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
